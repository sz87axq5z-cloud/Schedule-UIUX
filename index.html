<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç‰‡ä»˜ã‘ã‚³ãƒ¼ãƒãƒ³ã‚° - less is</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      line-height: 1.8;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ - ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼†ã‚¹ã‚¿ã‚¤ãƒªãƒƒã‚·ãƒ¥ */
    .proto-header {
      background: #000000;
      color: #ffffff;
      padding: 10px 16px;
      padding-top: max(10px, env(safe-area-inset-top));
      min-height: 44px;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .proto-header-brand {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .proto-header h1 {
      font-size: 0.9rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      margin: 0;
    }

    .proto-header p {
      display: none;
    }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ */
    .proto-nav {
      display: flex;
      background: #fafafa;
      border-bottom: 1px solid #e5e5e5;
      overflow-x: auto;
      position: sticky;
      top: 44px;
      z-index: 99;
      -webkit-overflow-scrolling: touch;
    }

    .proto-nav button {
      flex: 1;
      min-width: 100px;
      min-height: 48px;
      padding: 14px 12px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 0.85rem;
      color: #888;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-weight: 400;
      letter-spacing: 0.02em;
      -webkit-tap-highlight-color: transparent;
    }

    .proto-nav button:active {
      background: rgba(0,0,0,0.05);
    }

    .proto-nav button:hover {
      color: #1a1a1a;
    }

    .proto-nav button.active {
      color: #000000;
      border-bottom-color: #000000;
      font-weight: 500;
    }

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—è¡¨ç¤º - ãƒŸãƒ‹ãƒãƒ« */
    .user-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 2px;
      font-size: 0.7rem;
      font-weight: 400;
      margin-bottom: 10px;
      letter-spacing: 0.05em;
    }

    .user-badge.student {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    .user-badge.teacher {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    .user-badge.system {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ */
    .proto-section {
      display: none;
      padding: 20px 16px;
      max-width: 640px;
      margin: 0 auto;
      padding-bottom: 100px;
    }

    .proto-section.active {
      display: block;
    }

    .section-title {
      font-size: 1.15rem;
      margin-bottom: 12px;
      color: #1a1a1a;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .section-desc {
      color: #555;
      margin-bottom: 20px;
      padding: 14px 16px;
      background: #fafafa;
      border-radius: 6px;
      border-left: 3px solid #1a1a1a;
      font-size: 0.9rem;
      line-height: 1.7;
    }

    .section-desc.highlight {
      background: #fafafa;
      border-left-color: #1a1a1a;
    }

    /* ã‚«ãƒ¼ãƒ‰ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    .card {
      background: #ffffff;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 20px 16px;
      margin-bottom: 16px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 500;
      color: #1a1a1a;
      letter-spacing: 0.01em;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px 16px;
      min-height: 48px;
      border: 1px solid #d0d0d0;
      border-radius: 6px;
      font-size: 16px;
      background: #fafafa;
      -webkit-appearance: none;
      appearance: none;
    }

    .form-group select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #1a1a1a;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(0,0,0,0.05);
    }

    /* ãƒœã‚¿ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .btn {
      padding: 14px 28px;
      min-height: 48px;
      border: none;
      border-radius: 6px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.15s;
      font-weight: 500;
      letter-spacing: 0.02em;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: #000000;
      color: #ffffff;
    }

    .btn-primary:hover {
      background: #333333;
    }

    .btn-primary:active {
      background: #444444;
      transform: scale(0.98);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #1a1a1a;
      border: 1px solid #e0e0e0;
    }

    .btn-secondary:active {
      background: #e8e8e8;
      transform: scale(0.98);
    }

    .btn-success {
      background: #1a1a1a;
      color: #ffffff;
    }

    .btn-success:active {
      background: #333333;
      transform: scale(0.98);
    }

    .btn-sm {
      padding: 10px 16px;
      min-height: 40px;
      font-size: 0.85rem;
    }

    /* ãƒ•ãƒ«ãƒ¯ã‚¤ãƒ‰ãƒœã‚¿ãƒ³ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰ */
    .btn-block {
      width: 100%;
    }

    /* é€²æ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    .student-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .student-item {
      display: flex;
      align-items: center;
      padding: 16px;
      background: #fafafa;
      border-radius: 8px;
      border: 1px solid #e5e5e5;
      min-height: 70px;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.15s;
    }

    .student-item:active {
      background: #f0f0f0;
    }

    .student-avatar {
      width: 44px;
      height: 44px;
      border-radius: 6px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      margin-right: 14px;
      border: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .student-info {
      flex: 1;
      min-width: 0;
    }

    .student-name {
      font-weight: 500;
      margin-bottom: 4px;
      font-size: 0.95rem;
    }

    .student-task {
      font-size: 0.8rem;
      color: #888;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    .student-status {
      padding: 8px 14px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      flex-shrink: 0;
    }

    .status-good {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    .status-warning {
      background: #fafafa;
      color: #888;
      border: 1px solid #d0d0d0;
    }

    .status-danger {
      background: #1a1a1a;
      color: #fff;
    }

    .status-complete {
      background: #000;
      color: #fff;
    }

    /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ - ãƒŸãƒ‹ãƒãƒ« */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: #fafafa;
      padding: 20px;
      border-radius: 4px;
      text-align: center;
      border: 1px solid #e5e5e5;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 300;
      color: #000;
      letter-spacing: -0.02em;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #888;
      font-weight: 400;
    }

    /* LINEãƒ¢ãƒƒã‚¯ - ãƒŸãƒ‹ãƒãƒ« */
    .line-mock {
      background: #f5f5f5;
      border-radius: 8px;
      padding: 20px;
      max-width: 350px;
      margin: 0 auto;
      border: 1px solid #e0e0e0;
    }

    .line-header {
      text-align: center;
      color: #1a1a1a;
      margin-bottom: 15px;
      font-weight: 500;
      font-size: 0.9rem;
      letter-spacing: 0.02em;
    }

    .line-chat {
      background: #fff;
      border-radius: 4px;
      padding: 15px;
      min-height: 400px;
      border: 1px solid #e5e5e5;
    }

    .line-message {
      margin-bottom: 12px;
      max-width: 85%;
    }

    .line-message.bot {
      margin-right: auto;
    }

    .line-message.user {
      margin-left: auto;
    }

    .line-bubble {
      padding: 12px 15px;
      border-radius: 4px;
      font-size: 0.9rem;
      line-height: 1.6;
    }

    .line-message.bot .line-bubble {
      background: #f5f5f5;
      border: 1px solid #e5e5e5;
    }

    .line-message.user .line-bubble {
      background: #1a1a1a;
      color: white;
    }

    .line-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .line-btn {
      background: white;
      border: 1px solid #1a1a1a;
      color: #1a1a1a;
      padding: 14px;
      min-height: 48px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.15s;
      -webkit-tap-highlight-color: transparent;
    }

    .line-btn:active {
      background: #1a1a1a;
      color: white;
      transform: scale(0.98);
    }

    /* ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .task-item {
      display: flex;
      align-items: center;
      padding: 16px;
      background: #fafafa;
      border-radius: 8px;
      margin-bottom: 10px;
      border: 1px solid #e5e5e5;
      min-height: 60px;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.15s;
    }

    .task-item:active {
      background: #f0f0f0;
    }

    .task-checkbox {
      width: 28px;
      height: 28px;
      border: 2px solid #1a1a1a;
      border-radius: 4px;
      margin-right: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .task-checkbox.checked {
      background: #1a1a1a;
      color: white;
      font-size: 14px;
    }

    .task-content {
      flex: 1;
      min-width: 0;
    }

    .task-title {
      font-weight: 500;
      font-size: 0.95rem;
    }

    .task-time {
      font-size: 0.8rem;
      color: #888;
      margin-top: 2px;
    }

    /* é€²æ—ãƒãƒ¼ - ãƒŸãƒ‹ãƒãƒ« */
    .progress-container {
      margin: 20px 0;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .progress-bar {
      height: 4px;
      background: #e5e5e5;
      border-radius: 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #1a1a1a;
      border-radius: 0;
      transition: width 0.5s ease;
    }

    /* æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ« */
    .compare-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .compare-table th,
    .compare-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .compare-table th {
      background: #f8f8f8;
      font-weight: 600;
    }

    .compare-table .old {
      color: #999;
      text-decoration: line-through;
    }

    .compare-table .new {
      color: #059669;
      font-weight: 600;
    }

    /* ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠ - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin: 15px 0;
    }

    .template-item {
      padding: 14px;
      min-height: 56px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 12px;
      -webkit-tap-highlight-color: transparent;
    }

    .template-item:active {
      background: #f0f0f0;
      transform: scale(0.98);
    }

    .template-item.selected {
      border-color: #1a1a1a;
      border-width: 2px;
      background: #f5f5f5;
    }

    .template-icon {
      font-size: 1.4rem;
      width: 40px;
      text-align: center;
      flex-shrink: 0;
    }

    .template-text {
      flex: 1;
      min-width: 0;
    }

    .template-name {
      font-weight: 500;
      font-size: 0.9rem;
      margin-bottom: 3px;
    }

    .template-desc {
      font-size: 0.75rem;
      color: #888;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* è‡ªå‹•åŒ–ãƒ•ãƒ­ãƒ¼å›³ - ãƒŸãƒ‹ãƒãƒ« */
    .flow-diagram {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 20px 0;
    }

    .flow-step {
      display: flex;
      align-items: center;
      padding: 15px;
      background: #fafafa;
      border-radius: 4px;
      border: 1px solid #e5e5e5;
    }

    .flow-icon {
      width: 44px;
      height: 44px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      margin-right: 15px;
    }

    .flow-icon.student {
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
    }

    .flow-icon.system {
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
    }

    .flow-icon.teacher {
      background: #f5f5f5;
      border: 1px solid #e0e0e0;
    }

    .flow-content {
      flex: 1;
    }

    .flow-title {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .flow-desc {
      font-size: 0.85rem;
      color: #888;
    }

    .flow-arrow {
      text-align: center;
      color: #1a1a1a;
      font-size: 1.2rem;
    }

    /* å‰Šé™¤è¡¨ç¤º */
    .removed-feature {
      background: #fee2e2;
      border: 1px dashed #dc2626;
      padding: 10px 15px;
      border-radius: 8px;
      color: #991b1b;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    .removed-feature::before {
      content: 'å‰Šé™¤';
      background: #dc2626;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      margin-right: 10px;
    }

    /* ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .remind-setting {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .remind-chip {
      padding: 10px 18px;
      min-height: 44px;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.15s;
      border: 1px solid #d0d0d0;
      background: white;
      letter-spacing: 0.02em;
      -webkit-tap-highlight-color: transparent;
      display: inline-flex;
      align-items: center;
    }

    .remind-chip:active {
      transform: scale(0.96);
    }

    .remind-chip.active {
      background: #1a1a1a;
      color: white;
      border-color: #1a1a1a;
    }

    /* é€²æ—ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    .progress-checklist {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }

    .checklist-item {
      display: flex;
      align-items: center;
      padding: 14px 12px;
      min-height: 52px;
      background: #fafafa;
      border-radius: 6px;
      font-size: 0.9rem;
      border: 1px solid #e5e5e5;
      -webkit-tap-highlight-color: transparent;
    }

    .checklist-item.done {
      background: #f5f5f5;
      border-color: #1a1a1a;
    }

    .checklist-icon {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .checklist-item.done .checklist-icon {
      background: #1a1a1a;
      color: white;
    }

    .checklist-item:not(.done) .checklist-icon {
      background: #e5e5e5;
      color: #888;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ */
    @media (max-width: 600px) {
      .stats-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      .stat-card {
        padding: 14px 8px;
      }

      .stat-number {
        font-size: 1.4rem;
      }

      .stat-label {
        font-size: 0.7rem;
      }

      .template-grid {
        grid-template-columns: 1fr;
      }

      .progress-checklist {
        grid-template-columns: 1fr;
      }

      .proto-nav button {
        min-width: 80px;
        min-height: 44px;
        font-size: 0.8rem;
        padding: 12px 8px;
      }

      .proto-section {
        padding: 16px 12px;
        padding-bottom: 80px;
      }

      .card {
        padding: 16px 14px;
      }

      .section-title {
        font-size: 1.05rem;
      }

      .btn {
        width: 100%;
        padding: 16px;
      }

      .student-item {
        flex-wrap: wrap;
        gap: 10px;
      }

      .student-status {
        margin-left: auto;
      }
    }

    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translate(-50%, 20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

    @keyframes slideDown {
      from { opacity: 1; transform: translate(-50%, 0); }
      to { opacity: 0; transform: translate(-50%, 20px); }
    }

    .proto-section.active {
      animation: fadeIn 0.3s ease;
    }

    /* å½¹å‰²åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ - ãƒŸãƒ‹ãƒãƒ« */
    .role-toggle {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
    }

    .role-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 2px;
      background: transparent;
      color: rgba(255,255,255,0.6);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 400;
      letter-spacing: 0.05em;
      transition: all 0.2s ease;
    }

    .role-btn:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
    }

    .role-btn.active {
      background: white;
      color: #000;
      border-color: white;
    }

    .role-icon {
      font-size: 1.1rem;
    }

    /* å ´æ‰€é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ - ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒå¯¾å¿œ */
    .location-option {
      display: flex;
      align-items: center;
      padding: 16px 18px;
      min-height: 56px;
      cursor: pointer;
      border-bottom: 1px solid #e5e5e5;
      transition: background 0.15s;
      -webkit-tap-highlight-color: transparent;
    }

    .location-option:active {
      background: #f0f0f0;
    }

    .location-option.selected {
      background: #f5f5f5;
    }

    .location-option .loc-icon {
      font-size: 1.3rem;
      width: 36px;
      text-align: center;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .location-option .loc-name {
      flex: 1;
      font-size: 0.95rem;
    }

    .location-option .loc-check {
      color: #1a1a1a;
      font-size: 1.2rem;
      opacity: 0;
      transition: opacity 0.2s;
      flex-shrink: 0;
    }

    .location-option.selected .loc-check {
      opacity: 1;
    }

    @media (max-width: 600px) {
      .role-toggle {
        flex-direction: column;
        gap: 8px;
      }

      .role-btn {
        padding: 8px 16px;
        font-size: 0.85rem;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header class="proto-header">
    <div class="proto-header-brand">
      <h1>ç‰‡ä»˜ã‘ã‚³ãƒ¼ãƒãƒ³ã‚°</h1>
    </div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹è¡¨ç¤º -->
    <div id="login-area">
      <!-- æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ -->
      <div id="login-prompt" style="display: block;">
        <button id="google-login-btn" onclick="handleGoogleLogin()" style="background: white; color: #1a1a1a; border: none; padding: 8px 14px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; font-weight: 500;">
          <svg width="14" height="14" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          ãƒ­ã‚°ã‚¤ãƒ³
        </button>
      </div>
      <!-- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿æ™‚ -->
      <div id="logged-in-user" style="display: none;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span id="user-display-name" style="font-size: 0.8rem; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
          <button onclick="handleLogout()" style="background: transparent; border: 1px solid rgba(255,255,255,0.4); color: white; padding: 6px 12px; border-radius: 4px; font-size: 0.7rem; cursor: pointer;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
      </div>
    </div>

    <!-- å½¹å‰²åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ï¼ˆéè¡¨ç¤ºï¼‰ -->
    <div class="role-toggle" id="role-toggle" style="display: none;"></div>
  </header>

  <!-- ç”Ÿå¾’ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="proto-nav" id="nav-student">
    <button class="active" onclick="showSection('student-task')">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²</button>
    <button onclick="showSection('line-flow')">LINEé€šçŸ¥ã‚¤ãƒ¡ãƒ¼ã‚¸</button>
  </nav>

  <!-- è¬›å¸«ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="proto-nav" id="nav-teacher" style="display: none;">
    <button class="active" onclick="showSection('daily-tasks')">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</button>
    <button onclick="showSection('dashboard')">ç”Ÿå¾’ã®é€²æ—</button>
    <button onclick="showSection('teacher-setting')">è¨­å®š</button>
  </nav>

  <!-- å¤‰æ›´ç‚¹ã¾ã¨ã‚ -->
  <section id="changes" class="proto-section">
    <h2 class="section-title">æ–°ã—ããªã‚‹ã“ã¨</h2>
    <div class="section-desc highlight">
      <strong>ç›®çš„ï¼š</strong>ç”Ÿå¾’ã•ã‚“ãŒã€Œä¸€æ°—ã«ç‰‡ä»˜ã‘ã€ã‚’å®Œé‚ã§ãã‚‹ã‚ˆã†ã‚µãƒãƒ¼ãƒˆã€‚è¬›å¸«ãŒæ‰‹ã‚’ã‹ã‘ãªãã¦ã‚‚ã€ã‚¢ãƒ—ãƒªãŒè‡ªå‹•ã§ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚„ãƒ•ã‚©ãƒ­ãƒ¼ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚
    </div>

    <!-- ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ -->
    <div class="card">
      <div class="card-title">ğŸ“± ä»Šã®ã‚¢ãƒ—ãƒªã§ã§ãã‚‹ã“ã¨</div>
      <div style="margin-top: 15px; color: #666;">
        <div style="padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          âœ… Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨é€£æºã—ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
        </div>
        <div style="padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          âœ… LINEã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é€šçŸ¥ã‚’å—ã‘å–ã‚‹
        </div>
        <div style="padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          âœ… è¬›å¸«ãŒç”Ÿå¾’ã®äºˆå®šã‚’ç¢ºèªã§ãã‚‹
        </div>
      </div>
    </div>

    <!-- æ–°ã—ãè¿½åŠ ã•ã‚Œã‚‹æ©Ÿèƒ½ -->
    <div class="card" style="border: 2px solid #10b981;">
      <div class="card-title" style="color: #10b981;">âœ¨ æ–°ã—ãè¿½åŠ ã•ã‚Œã‚‹æ©Ÿèƒ½</div>
      <div style="margin-top: 15px;">

        <div style="padding: 15px; background: #ecfdf5; border-radius: 10px; margin-bottom: 12px;">
          <div style="font-weight: 600; color: #065f46; margin-bottom: 8px;">1. ç”Ÿå¾’ãŒè‡ªåˆ†ã§ç‰‡ä»˜ã‘ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç™»éŒ²</div>
          <div style="font-size: 0.9rem; color: #047857;">
            ã€Œã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆã€ã€Œå†·è”µåº«ã€ãªã©8ã¤ã®å‚è€ƒä¾‹ã‹ã‚‰é¸ã¶ã‹ã€ã€Œãã®ä»–ã€ã§è‡ªç”±ã«å ´æ‰€ã‚’å…¥åŠ›ã€‚<br>
            æ—¥ä»˜ã¨æ™‚é–“ï¼ˆä½•æ™‚ã‹ã‚‰ä½•æ™‚ã¾ã§ï¼‰ã‚’è‡ªåˆ†ã§æ±ºã‚ã¦ç™»éŒ²ã§ãã¾ã™ã€‚
          </div>
        </div>

        <div style="padding: 15px; background: #ecfdf5; border-radius: 10px; margin-bottom: 12px;">
          <div style="font-weight: 600; color: #065f46; margin-bottom: 8px;">2. LINEã§è‡ªå‹•ãƒªãƒã‚¤ãƒ³ãƒ‰</div>
          <div style="font-size: 0.9rem; color: #047857;">
            ç™»éŒ²ã—ãŸæ—¥æ™‚ã«åˆã‚ã›ã¦ã€LINEã§è‡ªå‹•çš„ã«ãƒªãƒã‚¤ãƒ³ãƒ‰ãŒå±Šãã¾ã™ã€‚<br>
            ä¾‹ï¼šå‰æ—¥ã®å¤œã€å½“æ—¥ã®æœã€30åˆ†å‰ãªã©ï¼ˆè¬›å¸«ãŒè¨­å®šå¯èƒ½ï¼‰
          </div>
        </div>

        <div style="padding: 15px; background: #ecfdf5; border-radius: 10px; margin-bottom: 12px;">
          <div style="font-weight: 600; color: #065f46; margin-bottom: 8px;">3. ãƒ“ãƒ•ã‚©ãƒ¼ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã§å®Œäº†å ±å‘Š</div>
          <div style="font-size: 0.9rem; color: #047857;">
            ç‰‡ä»˜ã‘å‰ã®ã€Œãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸã€â†’ ç‰‡ä»˜ã‘å¾Œã®ã€Œã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã€ã‚’LINEã«é€ä¿¡ã€‚<br>
            è¬›å¸«ãŒå†™çœŸã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦OKã™ã‚‹ã¨ã€å®Œäº†é€šçŸ¥ãŒå±Šãã¾ã™ã€‚
          </div>
        </div>

        <div style="padding: 15px; background: #fce7f3; border-radius: 10px; margin-bottom: 12px;">
          <div style="font-weight: 600; color: #be185d; margin-bottom: 8px;">4. è¬›å¸«ã®ã€Œä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ç”»é¢ï¼ˆNEW!ï¼‰</div>
          <div style="font-size: 0.9rem; color: #9d174d;">
            <strong>æ¯æœã‚„ã‚‹ã“ã¨ãŒæ˜ç¢ºã«ï¼</strong><br>
            ãƒ»èª°ã®å†™çœŸã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚Œã°ã„ã„ã‹<br>
            ãƒ»èª°ã«ãƒ•ã‚©ãƒ­ãƒ¼ãŒå¿…è¦ã‹<br>
            å‰æ—¥åˆ†ã®ã¿è¡¨ç¤ºã•ã‚Œã€æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã¯è¿½åŠ ã•ã‚Œã¾ã›ã‚“ã€‚
          </div>
        </div>

        <div style="padding: 15px; background: #ecfdf5; border-radius: 10px; margin-bottom: 12px;">
          <div style="font-weight: 600; color: #065f46; margin-bottom: 8px;">5. ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å†™çœŸãƒã‚§ãƒƒã‚¯å®Œäº†</div>
          <div style="font-size: 0.9rem; color: #047857;">
            ãƒ“ãƒ•ã‚©ãƒ¼ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã‚’è¦‹æ¯”ã¹ã¦ã€ŒOKã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚<br>
            ç”Ÿå¾’ã«ã€ŒOKã§ã™ï¼æ¬¡ã®ç‰‡ä»˜ã‘ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€ã¨è‡ªå‹•é€šçŸ¥ã•ã‚Œã¾ã™ã€‚
          </div>
        </div>

        <div style="padding: 15px; background: #ecfdf5; border-radius: 10px;">
          <div style="font-weight: 600; color: #065f46; margin-bottom: 8px;">6. è‡ªå‹•ãƒ•ã‚©ãƒ­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
          <div style="font-size: 0.9rem; color: #047857;">
            ç‰‡ä»˜ã‘ãŒå®Œäº†ã—ã¦ã„ãªã„å ´åˆã€ç¿Œæ—¥ã‚„3æ—¥å¾Œã«è‡ªå‹•ã§ãƒ•ã‚©ãƒ­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ã‚‰ã‚Œã¾ã™ã€‚<br>
            è¬›å¸«ãŒé€£çµ¡ã—ãªãã¦ã‚‚ã€ã‚¢ãƒ—ãƒªãŒã‚µãƒãƒ¼ãƒˆã—ã¦ãã‚Œã¾ã™ã€‚
          </div>
        </div>

      </div>
    </div>

    <!-- è¬›å¸«ã®ãƒ¡ãƒªãƒƒãƒˆ -->
    <div class="card">
      <div class="card-title">ğŸ‘©â€ğŸ« è¬›å¸«ã«ã¨ã£ã¦ã®ãƒ¡ãƒªãƒƒãƒˆ</div>
      <div class="stats-grid" style="margin-top: 15px;">
        <div class="stat-card">
          <div class="stat-number" style="font-size: 1.3rem;">æ¯æœ5åˆ†</div>
          <div class="stat-label">å†™çœŸãƒã‚§ãƒƒã‚¯</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" style="font-size: 1.5rem;">è‡ªå‹•åŒ–</div>
          <div class="stat-label">ãƒªãƒã‚¤ãƒ³ãƒ‰</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" style="font-size: 1.5rem;">è‡ªå‹•åŒ–</div>
          <div class="stat-label">ãƒ•ã‚©ãƒ­ãƒ¼</div>
        </div>
      </div>
      <p style="text-align: center; color: #666; margin-top: 15px; font-size: 0.95rem;">
        ğŸ‘‰ <strong>æ¯æœã€Œä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ã‚’æ¶ˆåŒ–ã™ã‚‹ã ã‘ã§OKï¼</strong><br>
        å‰æ—¥åˆ†ã®ã¿è¡¨ç¤ºã€è¿½åŠ ã‚¿ã‚¹ã‚¯ãªã—ã€‚ã‚„ã‚‹ã“ã¨ãŒæ˜ç¢ºã§ã™ã€‚
      </p>
    </div>

    <!-- ç”Ÿå¾’ã®ãƒ¡ãƒªãƒƒãƒˆ -->
    <div class="card">
      <div class="card-title">ğŸ‘¤ ç”Ÿå¾’ã«ã¨ã£ã¦ã®ãƒ¡ãƒªãƒƒãƒˆ</div>
      <div style="margin-top: 15px;">
        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          <span style="font-size: 1.3rem;">ğŸ“…</span>
          <span>è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ±ºã‚ã‚‰ã‚Œã‚‹</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          <span style="font-size: 1.3rem;">ğŸ””</span>
          <span>å¿˜ã‚Œã¦ã„ã¦ã‚‚LINEã§æ€ã„å‡ºã•ã›ã¦ãã‚Œã‚‹</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f8f8; border-radius: 8px; margin-bottom: 8px;">
          <span style="font-size: 1.3rem;">ğŸ“¸</span>
          <span>å†™çœŸã‚’é€ã‚‹ã ã‘ã§å ±å‘Šå®Œäº†ï¼ˆç°¡å˜ï¼ï¼‰</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f8f8; border-radius: 8px;">
          <span style="font-size: 1.3rem;">âœ…</span>
          <span>ã©ã“ã¾ã§çµ‚ã‚ã£ãŸã‹ä¸€ç›®ã§ã‚ã‹ã‚‹</span>
        </div>
      </div>
    </div>

    <!-- å…¨ä½“ã®æµã‚Œ -->
    <div class="card">
      <div class="card-title">ğŸ”„ ä½¿ã„æ–¹ã®æµã‚Œ</div>
      <div style="margin-top: 15px;">
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
          <div style="width: 36px; height: 36px; background: #667eea; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px;">1</div>
          <div>
            <div style="font-weight: 600;">ç”Ÿå¾’ãŒã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²</div>
            <div style="font-size: 0.85rem; color: #666;">ç‰‡ä»˜ã‘ã‚‹å ´æ‰€ã”ã¨ã«æ—¥æ™‚ã‚’ç™»éŒ²</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
          <div style="width: 36px; height: 36px; background: #667eea; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px;">2</div>
          <div>
            <div style="font-weight: 600;">LINEã§ãƒªãƒã‚¤ãƒ³ãƒ‰ãŒå±Šã</div>
            <div style="font-size: 0.85rem; color: #666;">å½“æ—¥æœã€Œãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸã‚’é€ã£ã¦ã­ã€</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
          <div style="width: 36px; height: 36px; background: #667eea; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px;">3</div>
          <div>
            <div style="font-weight: 600;">ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸ â†’ ç‰‡ä»˜ã‘ â†’ ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸ</div>
            <div style="font-size: 0.85rem; color: #666;">LINEã«å†™çœŸã‚’é€ä¿¡</div>
          </div>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 15px;">
          <div style="width: 36px; height: 36px; background: #fce7f3; color: #be185d; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px;">4</div>
          <div>
            <div style="font-weight: 600;">è¬›å¸«ãŒç¿Œæœãƒã‚§ãƒƒã‚¯</div>
            <div style="font-size: 0.85rem; color: #666;">ã€Œä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ã§å†™çœŸç¢ºèª â†’ OKãƒœã‚¿ãƒ³</div>
          </div>
        </div>
        <div style="display: flex; align-items: center;">
          <div style="width: 36px; height: 36px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 12px;">âœ“</div>
          <div>
            <div style="font-weight: 600;">ç”Ÿå¾’ã«å®Œäº†é€šçŸ¥ â†’ æ¬¡ã®å ´æ‰€ã¸</div>
            <div style="font-size: 0.85rem; color: #666;">ã€ŒOKã§ã™ï¼æ¬¡ã®ç‰‡ä»˜ã‘ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼ã€</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ç”Ÿå¾’ç”¨ã‚¿ã‚¹ã‚¯ç™»éŒ² -->
  <section id="student-task" class="proto-section active">

    <!-- ã‚µãƒ–ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div style="display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid #e5e5e5;">
      <button id="subtab-new" onclick="showStudentSubtab('new')" style="flex: 1; padding: 12px 16px; background: none; border: none; border-bottom: 2px solid #1a1a1a; margin-bottom: -2px; font-size: 0.9rem; font-weight: 500; color: #1a1a1a; cursor: pointer;">
        æ–°è¦ç™»éŒ²
      </button>
      <button id="subtab-registered" onclick="showStudentSubtab('registered')" style="flex: 1; padding: 12px 16px; background: none; border: none; border-bottom: 2px solid transparent; margin-bottom: -2px; font-size: 0.9rem; font-weight: 400; color: #888; cursor: pointer;">
        ç™»éŒ²æ¸ˆã¿äºˆå®š
      </button>
    </div>

    <!-- ========== æ–°è¦ç™»éŒ²ã‚¨ãƒªã‚¢ ========== -->
    <div id="student-subtab-new">

    <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
    <div id="step-indicator" style="display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;">
      <div class="step-dot active" data-step="1" style="width: 10px; height: 10px; border-radius: 50%; background: #1a1a1a; transition: all 0.3s;"></div>
      <div class="step-dot" data-step="2" style="width: 10px; height: 10px; border-radius: 50%; background: #e0e0e0; transition: all 0.3s;"></div>
      <div class="step-dot" data-step="3" style="width: 10px; height: 10px; border-radius: 50%; background: #e0e0e0; transition: all 0.3s;"></div>
    </div>

    <!-- ========== STEP 1: å ´æ‰€é¸æŠ ========== -->
    <div id="wizard-step-1" class="wizard-step">
      <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
      <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
        <div style="font-size: 0.75rem; opacity: 0.5; letter-spacing: 0.1em; margin-bottom: 6px;">STEP 1 / 3</div>
        <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
          ç‰‡ä»˜ã‘ã‚‹å ´æ‰€ã‚’é¸ã¶
        </div>
        <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
          ç‰‡ä»˜ã‘ãŸã„å ´æ‰€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦é¸æŠ
        </div>
      </div>

      <!-- å ´æ‰€é¸æŠã‚«ãƒ¼ãƒ‰ -->
      <div class="card" style="border: 1px solid #e5e5e5;">
        <div class="card-header">
          <div class="card-title" style="font-size: 1rem;">å ´æ‰€ã‚’é¸æŠ</div>
          <span id="selectedCountBadge" style="background: #1a1a1a; color: white; padding: 4px 12px; border-radius: 2px; font-size: 0.8rem;">0ç®‡æ‰€</span>
        </div>

      <!-- ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å½¢å¼ã®å ´æ‰€é¸æŠ -->
      <div id="locationDropdown" style="border: 1px solid #1a1a1a; border-radius: 4px; overflow: hidden; margin-top: 10px;">
        <!-- é¸æŠãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰ -->
        <div onclick="toggleLocationDropdown()" style="background: #1a1a1a; color: white; padding: 14px 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-weight: 400; font-size: 0.9rem; letter-spacing: 0.02em;">å ´æ‰€ã‚’é¸æŠ</div>
            <div style="font-size: 0.8rem; opacity: 0.7;" id="selectedCount">3ç®‡æ‰€é¸æŠä¸­</div>
          </div>
          <span id="dropdownArrow" style="font-size: 1rem; transition: transform 0.3s;">â–¼</span>
        </div>

        <!-- é¸æŠãƒªã‚¹ãƒˆ -->
        <div id="locationList" style="max-height: 400px; overflow-y: auto; background: white;">
          <!-- è¡£é¡ãƒ»ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ‘• è¡£é¡ãƒ»ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³</div>
          <label class="location-option selected" data-location="closet">
            <span class="loc-icon">ğŸ‘”</span>
            <span class="loc-name">ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="wardrobe">
            <span class="loc-icon">ğŸ§¥</span>
            <span class="loc-name">ã‚¿ãƒ³ã‚¹ãƒ»è¡£è£…ã‚±ãƒ¼ã‚¹</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="shoes">
            <span class="loc-icon">ğŸ‘Ÿ</span>
            <span class="loc-name">é´ç®±ãƒ»ã‚·ãƒ¥ãƒ¼ã‚ºã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="bags">
            <span class="loc-icon">ğŸ‘œ</span>
            <span class="loc-name">ãƒãƒƒã‚°ãƒ»ã‚«ãƒãƒ³åç´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="accessories">
            <span class="loc-icon">ğŸ’</span>
            <span class="loc-name">ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ãƒ»å°ç‰©</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- ã‚­ãƒƒãƒãƒ³ãƒ»é£Ÿå“ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ³ ã‚­ãƒƒãƒãƒ³ãƒ»é£Ÿå“</div>
          <label class="location-option selected" data-location="fridge">
            <span class="loc-icon">ğŸ§Š</span>
            <span class="loc-name">å†·è”µåº«ãƒ»å†·å‡åº«</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="pantry">
            <span class="loc-icon">ğŸ¥«</span>
            <span class="loc-name">ãƒ‘ãƒ³ãƒˆãƒªãƒ¼ãƒ»é£Ÿå“åº«</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="kitchen-cabinet">
            <span class="loc-icon">ğŸ½ï¸</span>
            <span class="loc-name">é£Ÿå™¨æ£š</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="kitchen-drawer">
            <span class="loc-icon">ğŸ¥„</span>
            <span class="loc-name">ã‚­ãƒƒãƒãƒ³å¼•ãå‡ºã—ãƒ»ã‚«ãƒˆãƒ©ãƒªãƒ¼</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="cooking-tools">
            <span class="loc-icon">ğŸ³</span>
            <span class="loc-name">èª¿ç†å™¨å…·ãƒ»é‹é¡</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="under-sink">
            <span class="loc-icon">ğŸ§´</span>
            <span class="loc-name">ã‚·ãƒ³ã‚¯ä¸‹åç´</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- æ°´å›ã‚Š -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸš¿ æ°´å›ã‚Š</div>
          <label class="location-option" data-location="bathroom">
            <span class="loc-icon">ğŸ›</span>
            <span class="loc-name">æµ´å®¤ãƒ»ãƒã‚¹ãƒ«ãƒ¼ãƒ </span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="washroom">
            <span class="loc-icon">ğŸª¥</span>
            <span class="loc-name">æ´—é¢æ‰€ãƒ»æ´—é¢å°ä¸‹</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="toilet">
            <span class="loc-icon">ğŸš½</span>
            <span class="loc-name">ãƒˆã‚¤ãƒ¬ãƒ»ãƒˆã‚¤ãƒ¬åç´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="laundry">
            <span class="loc-icon">ğŸ§º</span>
            <span class="loc-name">æ´—æ¿¯æ©Ÿå‘¨ã‚Šãƒ»ãƒ©ãƒ³ãƒ‰ãƒªãƒ¼</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- ãƒªãƒ“ãƒ³ã‚°ãƒ»å±…å®¤ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ›‹ï¸ ãƒªãƒ“ãƒ³ã‚°ãƒ»å±…å®¤</div>
          <label class="location-option" data-location="living">
            <span class="loc-icon">ğŸ›‹ï¸</span>
            <span class="loc-name">ãƒªãƒ“ãƒ³ã‚°å…¨ä½“</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="tv-area">
            <span class="loc-icon">ğŸ“º</span>
            <span class="loc-name">ãƒ†ãƒ¬ãƒ“å‘¨ã‚Šãƒ»AVæ©Ÿå™¨</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="bookshelf">
            <span class="loc-icon">ğŸ“š</span>
            <span class="loc-name">æœ¬æ£šãƒ»æ›¸æ£š</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="desk">
            <span class="loc-icon">ğŸ–¥ï¸</span>
            <span class="loc-name">ãƒ‡ã‚¹ã‚¯ãƒ»ä½œæ¥­ã‚¹ãƒšãƒ¼ã‚¹</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="storage-shelf">
            <span class="loc-icon">ğŸ—„ï¸</span>
            <span class="loc-name">åç´æ£šãƒ»ãƒ©ãƒƒã‚¯</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- å¯å®¤ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ›ï¸ å¯å®¤</div>
          <label class="location-option" data-location="bedroom">
            <span class="loc-icon">ğŸ›ï¸</span>
            <span class="loc-name">å¯å®¤å…¨ä½“</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="nightstand">
            <span class="loc-icon">ğŸ›‹ï¸</span>
            <span class="loc-name">ãƒŠã‚¤ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ãƒ™ãƒƒãƒ‰ã‚µã‚¤ãƒ‰</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="dresser">
            <span class="loc-icon">ğŸª</span>
            <span class="loc-name">ãƒ‰ãƒ¬ãƒƒã‚µãƒ¼ãƒ»åŒ–ç²§å°</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- ç„é–¢ãƒ»å»Šä¸‹ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸšª ç„é–¢ãƒ»å»Šä¸‹</div>
          <label class="location-option selected" data-location="entrance">
            <span class="loc-icon">ğŸšª</span>
            <span class="loc-name">ç„é–¢ãƒ»ç„é–¢åç´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="hallway">
            <span class="loc-icon">ğŸš¶</span>
            <span class="loc-name">å»Šä¸‹ãƒ»å»Šä¸‹åç´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="umbrella">
            <span class="loc-icon">â˜‚ï¸</span>
            <span class="loc-name">å‚˜ç«‹ã¦ãƒ»ãƒ¬ã‚¤ãƒ³ã‚³ãƒ¼ãƒˆ</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- å­ä¾›éƒ¨å±‹ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ§¸ å­ä¾›éƒ¨å±‹</div>
          <label class="location-option" data-location="kids-room">
            <span class="loc-icon">ğŸ§’</span>
            <span class="loc-name">å­ä¾›éƒ¨å±‹å…¨ä½“</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="toys">
            <span class="loc-icon">ğŸ§¸</span>
            <span class="loc-name">ãŠã‚‚ã¡ã‚ƒåç´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="school-stuff">
            <span class="loc-icon">ğŸ’</span>
            <span class="loc-name">å­¦ç”¨å“ãƒ»ãƒ©ãƒ³ãƒ‰ã‚»ãƒ«</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- åç´ã‚¹ãƒšãƒ¼ã‚¹ -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ“¦ åç´ã‚¹ãƒšãƒ¼ã‚¹</div>
          <label class="location-option" data-location="oshiire">
            <span class="loc-icon">ğŸ“¦</span>
            <span class="loc-name">æŠ¼å…¥ã‚Œ</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="storage-room">
            <span class="loc-icon">ğŸ </span>
            <span class="loc-name">ç´æˆ¸ãƒ»ç‰©ç½®éƒ¨å±‹</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="ceiling-storage">
            <span class="loc-icon">â¬†ï¸</span>
            <span class="loc-name">å¤©è¢‹ãƒ»ãƒ­ãƒ•ãƒˆ</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="under-floor">
            <span class="loc-icon">â¬‡ï¸</span>
            <span class="loc-name">åºŠä¸‹åç´</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- æ›¸é¡ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ« -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ“„ æ›¸é¡ãƒ»ãƒ‡ã‚¸ã‚¿ãƒ«</div>
          <label class="location-option" data-location="documents">
            <span class="loc-icon">ğŸ“„</span>
            <span class="loc-name">æ›¸é¡ãƒ»éƒµä¾¿ç‰©</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="photos">
            <span class="loc-icon">ğŸ“·</span>
            <span class="loc-name">å†™çœŸãƒ»ã‚¢ãƒ«ãƒãƒ </span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="digital">
            <span class="loc-icon">ğŸ’¾</span>
            <span class="loc-name">ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ»PCå†…</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- å±‹å¤–ãƒ»ãã®ä»– -->
          <div style="background: #f8f8f8; padding: 8px 15px; font-weight: 600; font-size: 0.85rem; color: #666; border-bottom: 1px solid #eee;">ğŸ¡ å±‹å¤–ãƒ»ãã®ä»–</div>
          <label class="location-option" data-location="balcony">
            <span class="loc-icon">ğŸŒ¿</span>
            <span class="loc-name">ãƒ™ãƒ©ãƒ³ãƒ€ãƒ»ãƒãƒ«ã‚³ãƒ‹ãƒ¼</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="garage">
            <span class="loc-icon">ğŸš—</span>
            <span class="loc-name">ã‚¬ãƒ¬ãƒ¼ã‚¸ãƒ»é§è»Šå ´</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="garden-shed">
            <span class="loc-icon">ğŸšï¸</span>
            <span class="loc-name">ç‰©ç½®ãƒ»å€‰åº«</span>
            <span class="loc-check">âœ“</span>
          </label>
          <label class="location-option" data-location="car">
            <span class="loc-icon">ğŸš™</span>
            <span class="loc-name">è»Šå†…</span>
            <span class="loc-check">âœ“</span>
          </label>

          <!-- ãã®ä»– -->
          <label class="location-option other-option" data-location="other" style="border-top: 1px solid #1a1a1a; background: #fafafa;">
            <span class="loc-icon">âœï¸</span>
            <span class="loc-name" style="color: #1a1a1a;">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</span>
            <span class="loc-check">âœ“</span>
          </label>
        </div>
      </div>

      <!-- ãã®ä»–é¸æŠæ™‚ã®å…¥åŠ›æ¬„ -->
      <div id="customInput" style="display: none; margin-top: 15px; padding: 15px; background: #fafafa; border-radius: 4px; border: 1px solid #1a1a1a;">
        <div class="form-group" style="margin-bottom: 10px;">
          <label style="color: #1a1a1a; font-weight: 500;">ç‰‡ä»˜ã‘ã‚‹å ´æ‰€ã‚’å…¥åŠ›</label>
          <input type="text" placeholder="ä¾‹ï¼šå’Œå®¤ã€æ›¸æ–ã€ãƒšãƒƒãƒˆç”¨å“ ãªã©" style="margin-top: 5px;">
        </div>
        <button class="btn btn-secondary btn-sm" style="margin-top: 10px;">è¿½åŠ ã™ã‚‹</button>
      </div>

      <!-- é¸æŠæ¸ˆã¿è¡¨ç¤º -->
      <div id="selectedLocations" style="background: #f5f5f5; border-radius: 4px; padding: 12px; margin-top: 15px;">
        <div style="font-weight: 500; color: #1a1a1a; margin-bottom: 8px; font-size: 0.85rem;">é¸æŠä¸­: 3ç®‡æ‰€</div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
          <span style="background: white; border: 1px solid #1a1a1a; color: #1a1a1a; padding: 4px 12px; border-radius: 2px; font-size: 0.8rem; display: flex; align-items: center; gap: 6px;">
            ğŸ‘” ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ <span onclick="removeLocation(this)" style="cursor: pointer; opacity: 0.7;">Ã—</span>
          </span>
          <span style="background: white; border: 1px solid #1a1a1a; color: #1a1a1a; padding: 4px 12px; border-radius: 2px; font-size: 0.8rem; display: flex; align-items: center; gap: 6px;">
            ğŸ§Š å†·è”µåº«ãƒ»å†·å‡åº« <span onclick="removeLocation(this)" style="cursor: pointer; opacity: 0.7;">Ã—</span>
          </span>
          <span style="background: white; border: 1px solid #1a1a1a; color: #1a1a1a; padding: 4px 12px; border-radius: 2px; font-size: 0.8rem; display: flex; align-items: center; gap: 6px;">
            ğŸšª ç„é–¢ãƒ»ç„é–¢åç´ <span onclick="removeLocation(this)" style="cursor: pointer; opacity: 0.7;">Ã—</span>
          </span>
        </div>
      </div>
    </div>

      <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
      <button onclick="goToStep(2)" class="btn btn-primary" style="width: 100%; font-size: 1.1rem; padding: 15px; margin-top: 20px;">
        æ¬¡ã¸ â€” æ—¥æ™‚ã‚’æ±ºã‚ã‚‹ â†’
      </button>
    </div>
    <!-- ========== END STEP 1 ========== -->

    <!-- ========== STEP 2: æ—¥æ™‚è¨­å®š ========== -->
    <div id="wizard-step-2" class="wizard-step" style="display: none;">
      <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
      <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
        <div style="font-size: 0.75rem; opacity: 0.5; letter-spacing: 0.1em; margin-bottom: 6px;">STEP 2 / 3</div>
        <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
          æ—¥æ™‚ã‚’æ±ºã‚ã‚‹
        </div>
        <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
          é¸ã‚“ã å ´æ‰€ã”ã¨ã«ç‰‡ä»˜ã‘æ—¥æ™‚ã‚’è¨­å®š
        </div>
      </div>

      <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
      <button onclick="goToStep(1)" class="btn btn-secondary" style="margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
        â† å ´æ‰€é¸æŠã«æˆ»ã‚‹
      </button>

      <!-- æ—¥æ™‚è¨­å®šã‚«ãƒ¼ãƒ‰ -->
      <div class="card" style="border: 1px solid #e5e5e5;">

      <!-- æ³¨æ„æ›¸ã -->
      <div style="background: #fafafa; border: 1px solid #d0d0d0; border-radius: 4px; padding: 12px; margin-bottom: 20px;">
        <div style="display: flex; align-items: flex-start; gap: 8px;">
          <span style="font-size: 1rem;">*</span>
          <div>
            <div style="font-weight: 500; color: #1a1a1a; margin-bottom: 4px; font-size: 0.9rem;">1ç®‡æ‰€ã«ã¤ãæœ€ä½4æ™‚é–“ä»¥ä¸Šã®ç¢ºä¿ã‚’ãŠé¡˜ã„ã—ã¾ã™</div>
            <div style="font-size: 0.8rem; color: #666;">ç‰‡ä»˜ã‘ã¯æ€ã£ãŸä»¥ä¸Šã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚ä½™è£•ã‚’æŒã£ãŸæ™‚é–“è¨­å®šã§ã€ã—ã£ã‹ã‚Šç‰‡ä»˜ã‘ã‚’å®Œäº†ã•ã›ã¾ã—ã‚‡ã†ã€‚</div>
          </div>
        </div>
      </div>

      <!-- å‹•çš„ã«å ´æ‰€ã”ã¨ã®æ—¥æ™‚è¨­å®šã‚«ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
      <div id="step2-locations-container">
        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
      </div>
      </div>

      <!-- æ¬¡ã¸ãƒœã‚¿ãƒ³ -->
      <button onclick="goToStep(3)" class="btn btn-primary" style="width: 100%; font-size: 1.1rem; padding: 15px; margin-top: 20px;">
        æ¬¡ã¸ â€” ç¢ºèªç”»é¢ã¸ â†’
      </button>
    </div>
    <!-- ========== END STEP 2 ========== -->

    <!-- ========== STEP 3: ç¢ºèªãƒ»ç™»éŒ² ========== -->
    <div id="wizard-step-3" class="wizard-step" style="display: none;">
      <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
      <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
        <div style="font-size: 0.75rem; opacity: 0.5; letter-spacing: 0.1em; margin-bottom: 6px;">STEP 3 / 3</div>
        <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
          ç¢ºèªã—ã¦ç™»éŒ²
        </div>
        <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
          å†…å®¹ã‚’ç¢ºèªã—ã¦ç™»éŒ²ã‚’å®Œäº†
        </div>
      </div>

      <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
      <button onclick="goToStep(2)" class="btn btn-secondary" style="margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
        â† æ—¥æ™‚è¨­å®šã«æˆ»ã‚‹
      </button>

      <!-- ç¢ºèªã‚«ãƒ¼ãƒ‰ -->
      <div class="card" style="border: 2px solid #1a1a1a; background: #fafafa;">

      <!-- å‹•çš„ã«ç¢ºèªå†…å®¹ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
      <div id="step3-confirmation-container">
        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
      </div>

      <div style="background: #f5f5f5; border-radius: 4px; padding: 12px; margin-bottom: 15px; margin-top: 15px; border: 1px solid #e5e5e5;">
        <div style="font-size: 0.85rem; color: #666;">
          <strong style="color: #1a1a1a;">ç™»éŒ²å¾Œã®æµã‚Œ</strong><br>
          ãƒ»å„æ—¥ç¨‹ã®å‰æ—¥ã¨å½“æ—¥æœã«LINEã§ãƒªãƒã‚¤ãƒ³ãƒ‰ãŒå±Šãã¾ã™<br>
          ãƒ»ç‰‡ä»˜ã‘ãŒçµ‚ã‚ã£ãŸã‚‰LINEã«å†™çœŸã‚’é€ä¿¡<br>
          ãƒ»æ¬¡ã®äºˆå®šã¯è‡ªå‹•ã§æ¡ˆå†…ã•ã‚Œã¾ã™
        </div>
      </div>

      <button onclick="registerSchedule()" class="btn btn-primary" style="width: 100%; font-size: 1.1rem; padding: 15px;">
        ã“ã®å†…å®¹ã§ç™»éŒ²ã™ã‚‹
      </button>
      </div>
    </div>
    <!-- ========== END STEP 3 ========== -->

    </div>
    <!-- ========== END æ–°è¦ç™»éŒ²ã‚¨ãƒªã‚¢ ========== -->

    <!-- ========== ç™»éŒ²æ¸ˆã¿äºˆå®šã‚¨ãƒªã‚¢ ========== -->
    <div id="student-subtab-registered" style="display: none;">

    <!-- ç™»éŒ²æ¸ˆã¿ã®äºˆå®šï¼ˆå ´æ‰€ã”ã¨ï¼‰ -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ç™»éŒ²æ¸ˆã¿ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
      </div>

      <!-- å‹•çš„ã«ç™»éŒ²æ¸ˆã¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ -->
      <div id="registered-schedules-container">
        <p style="color: #666; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </div>

    <!-- å…¨ä½“é€²æ— -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">ã‚ãªãŸã®é€²æ—</div>
        <span style="color: #1a1a1a; font-weight: 500;">2/5 ç®‡æ‰€å®Œäº†</span>
      </div>

      <div class="progress-container" style="margin: 10px 0;">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 40%;"></div>
        </div>
      </div>

      <div class="progress-checklist">
        <div class="checklist-item done">
          <div class="checklist-icon">âœ“</div>
          <span>ğŸ³ ã‚­ãƒƒãƒãƒ³</span>
        </div>
        <div class="checklist-item done">
          <div class="checklist-icon">âœ“</div>
          <span>ğŸš¿ æ´—é¢æ‰€ãƒ»æµ´å®¤</span>
        </div>
        <div class="checklist-item">
          <div class="checklist-icon">3</div>
          <span>ğŸ‘• ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</span>
        </div>
        <div class="checklist-item">
          <div class="checklist-icon">4</div>
          <span>ğŸ§Š å†·è”µåº«</span>
        </div>
        <div class="checklist-item">
          <div class="checklist-icon">5</div>
          <span>ğŸ‘Ÿ ç„é–¢</span>
        </div>
      </div>
    </div>

    </div>
    <!-- ========== END ç™»éŒ²æ¸ˆã¿äºˆå®šã‚¨ãƒªã‚¢ ========== -->

  </section>

  <!-- è¬›å¸«ç”¨ï¼šä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ -->
  <section id="daily-tasks" class="proto-section">

    <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
    <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
      <div id="today-date-display" style="font-size: 0.8rem; opacity: 0.6; margin-bottom: 6px; letter-spacing: 0.1em;"></div>
      <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
        ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯
      </div>
      <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
        ç”Ÿå¾’ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ã‚’ç¢ºèª
      </div>
    </div>

    <!-- ä»Šæ—¥ã®ã‚µãƒãƒªãƒ¼ï¼ˆå‹•çš„ï¼‰ -->
    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
      <div style="flex: 1; background: #fafafa; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #e5e5e5;">
        <div id="today-scheduled-count" style="font-size: 1.4rem; font-weight: 300; color: #1a1a1a;">-</div>
        <div style="font-size: 0.75rem; color: #888;">æœ¬æ—¥äºˆå®š</div>
      </div>
      <div style="flex: 1; background: #059669; padding: 12px; border-radius: 4px; text-align: center;">
        <div id="pending-photos-count" style="font-size: 1.4rem; font-weight: 300; color: #fff;">-</div>
        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">å†™çœŸãƒã‚§ãƒƒã‚¯</div>
      </div>
      <div style="flex: 1; background: #1a1a1a; padding: 12px; border-radius: 4px; text-align: center;">
        <div id="overdue-count" style="font-size: 1.4rem; font-weight: 300; color: #fff;">-</div>
        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">è¦ãƒ•ã‚©ãƒ­ãƒ¼</div>
      </div>
    </div>

    <!-- å†™çœŸãƒã‚§ãƒƒã‚¯ï¼ˆæ‰¿èªå¾…ã¡ï¼‰ -->
    <div class="card" id="pending-photos-card" style="border: 2px solid #059669; position: relative; display: none;">
      <div style="position: absolute; top: -12px; right: 20px; background: #059669; color: white; padding: 4px 12px; border-radius: 2px; font-size: 0.75rem; font-weight: 400; letter-spacing: 0.02em;">
        è¦ãƒã‚§ãƒƒã‚¯
      </div>
      <div class="card-header">
        <div class="card-title" style="color: #059669;">ğŸ“· å†™çœŸãƒã‚§ãƒƒã‚¯</div>
        <span id="pending-photos-badge" style="background: #059669; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.75rem; font-weight: 400;">-ä»¶</span>
      </div>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 15px;">
        ç”Ÿå¾’ã‹ã‚‰é€ã‚‰ã‚ŒãŸãƒ“ãƒ•ã‚©ãƒ¼ãƒ»ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã‚’ç¢ºèªã—ã¦OKã—ã¾ã—ã‚‡ã†
      </p>
      <div id="pending-photos-container">
        <p style="color: #666; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </div>

    <!-- æœ¬æ—¥ã®äºˆå®šï¼ˆå‹•çš„ç”Ÿæˆï¼‰ -->
    <div class="card" style="border: 2px solid #1a1a1a; position: relative;">
      <div style="position: absolute; top: -12px; right: 20px; background: #1a1a1a; color: white; padding: 4px 12px; border-radius: 2px; font-size: 0.75rem; font-weight: 400; letter-spacing: 0.02em;">
        æœ¬æ—¥ã®äºˆå®š
      </div>
      <div class="card-header">
        <div class="card-title" style="color: #1a1a1a;">ğŸ“… æœ¬æ—¥ã®äºˆå®š</div>
        <span id="today-schedule-badge" style="background: #f5f5f5; color: #1a1a1a; padding: 4px 10px; border-radius: 2px; font-size: 0.75rem; font-weight: 400; border: 1px solid #e5e5e5;">-ä»¶</span>
      </div>
      <div id="today-schedules-container">
        <p style="color: #666; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </div>

    <!-- è¦ãƒ•ã‚©ãƒ­ãƒ¼ï¼ˆéå»ã®æœªå®Œäº†ï¼‰ -->
    <div class="card" style="border: 2px solid #1a1a1a;">
      <div class="card-header">
        <div class="card-title" style="color: #1a1a1a;">âš ï¸ è¦ãƒ•ã‚©ãƒ­ãƒ¼</div>
        <span id="overdue-badge" style="background: #1a1a1a; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.75rem; font-weight: 400;">-ä»¶</span>
      </div>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 15px;">
        äºˆå®šæ—¥ã‚’éããŸæœªå®Œäº†ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
      </p>
      <div id="overdue-schedules-container">
        <p style="color: #666; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
    </div>

    <!-- å®Œäº†çŠ¶æ…‹ -->
    <div class="card" style="background: #fafafa; text-align: center; padding: 30px; border: 1px solid #e5e5e5;">
      <div style="font-size: 1rem; margin-bottom: 10px; color: #1a1a1a;">â€”</div>
      <div style="font-size: 0.95rem; font-weight: 400; color: #1a1a1a; margin-bottom: 8px; letter-spacing: 0.02em;">
        ä¸Šè¨˜ã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã™ã‚Œã°ä»Šæ—¥ã¯OK
      </div>
      <div style="font-size: 0.8rem; color: #888;">
        æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã¯æ˜æ—¥ã®æœã¾ã§è¿½åŠ ã•ã‚Œã¾ã›ã‚“
      </div>
    </div>
  </section>

  <!-- è¬›å¸«ç”¨ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®š -->
  <section id="teacher-setting" class="proto-section">

    <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
    <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
      <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
        è¨­å®š
      </div>
      <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
        ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ä½œã—ã¾ã™ã€‚å¿…è¦ãªæ™‚ã ã‘å¤‰æ›´
      </div>
    </div>

    <!-- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³1: ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚¿ã‚¤ãƒŸãƒ³ã‚° -->
    <div class="card" id="accordion-remind">
      <div class="card-header" style="cursor: pointer;" onclick="toggleAccordion('remind')">
        <div style="display: flex; align-items: center; gap: 10px;">
          <span style="font-size: 1.2rem;">ğŸ””</span>
          <div class="card-title">ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚¿ã‚¤ãƒŸãƒ³ã‚°</div>
          <span style="background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">è¨­å®šæ¸ˆã¿</span>
        </div>
        <span id="accordion-remind-toggle" style="font-size: 1.2rem; color: #666; transition: transform 0.3s;">â–¶</span>
      </div>
      <div id="accordion-remind-content" style="display: none; padding-top: 15px; border-top: 1px solid #eee; margin-top: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <p style="color: #666; font-size: 0.9rem; margin: 0;">
            ç”Ÿå¾’ã®ç‰‡ä»˜ã‘æ—¥æ™‚ã«å¯¾ã—ã¦ã€ã„ã¤ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’é€ã‚‹ã‹è¨­å®šã—ã¾ã™ã€‚
          </p>
          <button class="btn btn-secondary btn-sm" onclick="addRemindTiming()">+ è¿½åŠ </button>
        </div>

      <div id="remindTimingList">
        <!-- ãƒªãƒã‚¤ãƒ³ãƒ‰1 -->
        <div class="remind-timing-item" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f8f8; border-radius: 8px; margin-bottom: 10px;">
          <div style="flex: 1;">
            <select style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px;">
              <option value="before">å‰æ—¥</option>
              <option value="same">å½“æ—¥</option>
              <option value="minutes">ã€‡åˆ†å‰</option>
              <option value="hours">ã€‡æ™‚é–“å‰</option>
            </select>
            <input type="time" value="20:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          <span class="remind-chip active" style="cursor: default;">ON</span>
          <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;">å‰Šé™¤</button>
        </div>

        <!-- ãƒªãƒã‚¤ãƒ³ãƒ‰2 -->
        <div class="remind-timing-item" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f8f8; border-radius: 8px; margin-bottom: 10px;">
          <div style="flex: 1;">
            <select style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px;">
              <option value="before">å‰æ—¥</option>
              <option value="same" selected>å½“æ—¥</option>
              <option value="minutes">ã€‡åˆ†å‰</option>
              <option value="hours">ã€‡æ™‚é–“å‰</option>
            </select>
            <input type="time" value="08:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          <span class="remind-chip active" style="cursor: default;">ON</span>
          <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;">å‰Šé™¤</button>
        </div>

        <!-- ãƒªãƒã‚¤ãƒ³ãƒ‰3ï¼ˆåˆ†å‰ï¼‰ -->
        <div class="remind-timing-item" style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f8f8; border-radius: 8px; margin-bottom: 10px;">
          <div style="flex: 1;">
            <select style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px;" onchange="toggleTimeInput(this)">
              <option value="before">å‰æ—¥</option>
              <option value="same">å½“æ—¥</option>
              <option value="minutes" selected>ã€‡åˆ†å‰</option>
              <option value="hours">ã€‡æ™‚é–“å‰</option>
            </select>
            <input type="number" value="30" min="1" max="120" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
            <span style="color: #666; margin-left: 4px;">åˆ†å‰</span>
          </div>
          <span class="remind-chip active" style="cursor: default;">ON</span>
          <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;">å‰Šé™¤</button>
        </div>
      </div>

      <p style="color: #888; font-size: 0.85rem; margin-top: 15px;">
        ä¾‹: ã€Œå‰æ—¥ 20:00ã€ã€Œå½“æ—¥ 8:00ã€ã€Œ30åˆ†å‰ã€ã®3å›ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚’é€ä¿¡
      </p>
      </div>
    </div>

    <!-- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³2: ãƒ•ã‚©ãƒ­ãƒ¼è¨­å®š -->
    <div class="card" id="accordion-follow">
      <div class="card-header" style="cursor: pointer;" onclick="toggleAccordion('follow')">
        <div style="display: flex; align-items: center; gap: 10px;">
          <span style="font-size: 1.2rem;">ğŸ“©</span>
          <div class="card-title">ãƒ•ã‚©ãƒ­ãƒ¼è¨­å®š</div>
          <span style="background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">è¨­å®šæ¸ˆã¿</span>
        </div>
        <span id="accordion-follow-toggle" style="font-size: 1.2rem; color: #666; transition: transform 0.3s;">â–¶</span>
      </div>
      <div id="accordion-follow-content" style="display: none; padding-top: 15px; border-top: 1px solid #eee; margin-top: 15px;">
      <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
        ç‰‡ä»˜ã‘å®Œäº†å ±å‘ŠãŒãªã„å ´åˆã€è‡ªå‹•ã§ãƒ•ã‚©ãƒ­ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚Šã¾ã™ã€‚
      </p>

      <div class="form-group">
        <label>1å›ç›®ã®ãƒ•ã‚©ãƒ­ãƒ¼</label>
        <div style="display: flex; gap: 10px; align-items: center;">
          <input type="number" value="1" min="1" max="7" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          <span>æ—¥å¾Œ</span>
          <input type="time" value="10:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          <span class="remind-chip active" style="cursor: pointer;">ON</span>
        </div>
      </div>

      <div class="form-group">
        <label>2å›ç›®ã®ãƒ•ã‚©ãƒ­ãƒ¼</label>
        <div style="display: flex; gap: 10px; align-items: center;">
          <input type="number" value="3" min="1" max="14" style="width: 60px; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          <span>æ—¥å¾Œ</span>
          <input type="time" value="10:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
          <span class="remind-chip active" style="cursor: pointer;">ON</span>
        </div>
      </div>

      <button class="btn btn-primary" style="width: 100%; margin-top: 10px;" onclick="saveRemindSettings(this)">è¨­å®šã‚’ä¿å­˜</button>
      </div>
    </div>

    <!-- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³3: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
    <div class="card" id="accordion-message">
      <div class="card-header" style="cursor: pointer;" onclick="toggleAccordion('message')">
        <div style="display: flex; align-items: center; gap: 10px;">
          <span style="font-size: 1.2rem;">ğŸ’¬</span>
          <div class="card-title">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</div>
          <span style="background: #d1fae5; color: #059669; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;">9ç¨®é¡</span>
        </div>
        <span id="accordion-message-toggle" style="font-size: 1.2rem; color: #666; transition: transform 0.3s;">â–¶</span>
      </div>
      <div id="accordion-message-content" style="display: none; padding-top: 15px; border-top: 1px solid #eee; margin-top: 15px;">
      <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
        ç‰‡ä»˜ã‘ã‚‹å ´æ‰€ã”ã¨ã«é€ã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†ã§ãã¾ã™ã€‚
      </p>

      <!-- ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ‘• ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>1å¹´ç€ã¦ã„ãªã„æœã‚’åŸºæº–ã«ä»•åˆ†ã‘ã—ã¾ã—ã‚‡ã†ï¼
è¿·ã£ãŸã‚‰ã€Œã¾ãŸç€ãŸã„ã‹ï¼Ÿã€ã§åˆ¤æ–­ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</textarea>
      </div>

      <!-- å†·è”µåº« -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ§Š å†·è”µåº«ãƒ»å†·å‡åº«</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>è³å‘³æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯ï¼å¥¥ã®æ–¹ã‹ã‚‰ç¢ºèªã‚’ã€‚
åŒã˜èª¿å‘³æ–™ãŒè¤‡æ•°ãªã„ã‹ã‚‚ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚</textarea>
      </div>

      <!-- ç„é–¢ -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ‘Ÿ ç„é–¢ãƒ»ã‚·ãƒ¥ãƒ¼ã‚º</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>å±¥ã„ã¦ã„ãªã„é´ã€å£Šã‚ŒãŸå‚˜ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
ç„é–¢ã¯å®¶ã®é¡”ï¼ã‚¹ãƒƒã‚­ãƒªã•ã›ã¾ã—ã‚‡ã†ã€‚</textarea>
      </div>

      <!-- ã‚­ãƒƒãƒãƒ³ -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ³ ã‚­ãƒƒãƒãƒ³</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>ä½¿ã£ã¦ã„ãªã„èª¿ç†å™¨å…·ã¯æ€ã„åˆ‡ã£ã¦æ‰‹æ”¾ã—ã¾ã—ã‚‡ã†ï¼
é‡è¤‡ã—ã¦ã„ã‚‹é“å…·ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã€‚</textarea>
      </div>

      <!-- æ´—é¢æ‰€ -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸš¿ æ´—é¢æ‰€ãƒ»æµ´å®¤</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>ä½¿ã„ã‹ã‘ã®ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã‚„åŒ–ç²§å“ã‚’ãƒã‚§ãƒƒã‚¯ï¼
å¤ã„ã‚¿ã‚ªãƒ«ã‚‚è¦‹ç›´ã—ã¾ã—ã‚‡ã†ã€‚</textarea>
      </div>

      <!-- æœ¬æ£š -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ“š æœ¬æ£šãƒ»æ›¸é¡</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>èª­ã¿çµ‚ã‚ã£ãŸæœ¬ã€å¤ã„æ›¸é¡ã‚’æ•´ç†ï¼
ã‚‚ã†èª­ã¾ãªã„æœ¬ã¯æ‰‹æ”¾ã™å€™è£œã«ã€‚</textarea>
      </div>

      <!-- ãƒªãƒ“ãƒ³ã‚° -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ›‹ï¸ ãƒªãƒ“ãƒ³ã‚°</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸Šã€åç´æ£šã®ä¸­ã‚’ãƒã‚§ãƒƒã‚¯ï¼
ã€Œã¨ã‚Šã‚ãˆãšç½®ã„ã¦ã‚ã‚‹ç‰©ã€ã‚’è¦‹ç›´ã—ã¾ã—ã‚‡ã†ã€‚</textarea>
      </div>

      <!-- å¯å®¤ -->
      <div class="message-template-item" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">ğŸ›ï¸ å¯å®¤ãƒ»ãƒ™ãƒƒãƒ‰å‘¨ã‚Š</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>ãƒ™ãƒƒãƒ‰ã‚µã‚¤ãƒ‰ã«ç½®ãã£ã±ãªã—ã®ç‰©ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
å¼•ãå‡ºã—ã®ä¸­ã‚‚æ•´ç†ã—ã¾ã—ã‚‡ã†ã€‚</textarea>
      </div>

      <!-- ãã®ä»–ç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ -->
      <div class="message-template-item" style="border: 1px solid #667eea; border-radius: 10px; padding: 15px; background: #f8f8ff;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <span style="font-weight: 600;">âœï¸ ãã®ä»–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</span>
          <button class="btn btn-secondary btn-sm" onclick="toggleEdit(this)">ç·¨é›†</button>
        </div>
        <textarea style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.9rem; resize: vertical; min-height: 60px;" disabled>ç‰‡ä»˜ã‘é–‹å§‹ã§ã™ï¼
ã€Œä½¿ã£ã¦ã„ã‚‹/ä½¿ã£ã¦ã„ãªã„ã€ã§ä»•åˆ†ã‘ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</textarea>
        <p style="color: #667eea; font-size: 0.8rem; margin-top: 8px;">
          â€» ç”Ÿå¾’ãŒã€Œãã®ä»–ã€ã§ç™»éŒ²ã—ãŸå ´æ‰€ã«ã¯ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¾ã™
        </p>
      </div>

      <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="saveMessageTemplates(this)">å…¨ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜</button>
      </div>
    </div>
  </section>

  <!-- é€²æ—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆè¬›å¸«ç”¨ï¼‰ -->
  <section id="dashboard" class="proto-section">

    <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
    <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
      <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
        ç”Ÿå¾’ã®é€²æ—
      </div>
      <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
        ç”Ÿå¾’ã”ã¨ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³ã‚’ç¢ºèª
      </div>
    </div>

    <!-- ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
      <div style="flex: 1; background: #fafafa; padding: 15px; border-radius: 4px; text-align: center; border: 1px solid #e5e5e5;">
        <div id="student-count" style="font-size: 1.6rem; font-weight: 300; color: #1a1a1a;">-</div>
        <div style="font-size: 0.75rem; color: #888;">ç”Ÿå¾’æ•°</div>
      </div>
      <div style="flex: 1; background: #1a1a1a; padding: 15px; border-radius: 4px; text-align: center;">
        <div id="total-schedule-count" style="font-size: 1.6rem; font-weight: 300; color: #fff;">-</div>
        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);">å…¨äºˆå®šæ•°</div>
      </div>
      <div style="flex: 1; background: #fafafa; padding: 15px; border-radius: 4px; text-align: center; border: 1px solid #e5e5e5;">
        <div id="completed-count" style="font-size: 1.6rem; font-weight: 300; color: #1a1a1a;">-</div>
        <div style="font-size: 0.75rem; color: #888;">å®Œäº†</div>
      </div>
    </div>

    <!-- ç”Ÿå¾’ä¸€è¦§ï¼ˆå‹•çš„ç”Ÿæˆï¼‰ -->
    <div id="students-progress-container">
      <p style="color: #666; text-align: center;">èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
  </section>

  <!-- LINEé€£æº -->
  <section id="line-flow" class="proto-section">

    <!-- ãƒŸãƒ‹ãƒãƒ«ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰ -->
    <div style="background: #000; color: white; border-radius: 4px; padding: 24px 20px; margin-bottom: 24px; text-align: center;">
      <div style="font-size: 1.1rem; font-weight: 300; letter-spacing: 0.05em; margin-bottom: 8px;">
        LINEé€šçŸ¥ã‚¤ãƒ¡ãƒ¼ã‚¸
      </div>
      <div style="font-size: 0.85rem; opacity: 0.7; letter-spacing: 0.02em;">
        ç‰‡ä»˜ã‘æ—¥ã«ãƒªãƒã‚¤ãƒ³ãƒ‰ â†’ å†™çœŸã‚’é€ã‚‹ â†’ å®Œäº†
      </div>
    </div>

    <div class="line-mock">
      <div class="line-header">ç‰‡ä»˜ã‘ã‚µãƒãƒ¼ãƒˆBot</div>
      <div class="line-chat">
        <div class="line-message bot">
          <div class="line-bubble">
            ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼<br><br>
            ä»Šæ—¥ã¯<strong>ã€Œã‚­ãƒƒãƒãƒ³ã€</strong>ã®ç‰‡ä»˜ã‘æ—¥ã§ã™ğŸ³<br><br>
            ãƒã‚¤ãƒ³ãƒˆï¼šä½¿ã£ã¦ã„ãªã„èª¿ç†å™¨å…·ã¯æ€ã„åˆ‡ã£ã¦æ‰‹æ”¾ã—ã¾ã—ã‚‡ã†ï¼
          </div>
        </div>

        <div class="line-message bot">
          <div class="line-bubble">
            ã¾ãš<strong>ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸ</strong>ã‚’é€ã£ã¦ã‹ã‚‰ç‰‡ä»˜ã‘ã‚’å§‹ã‚ã¦ãã ã•ã„ğŸ“¸
          </div>
          <div class="line-buttons">
            <div class="line-btn">ä»Šæ—¥ã¯é›£ã—ã„â†’æ—¥ç¨‹å¤‰æ›´</div>
          </div>
        </div>

        <div class="line-message user">
          <div class="line-bubble">
            ğŸ“· [ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸ]
          </div>
        </div>

        <div class="line-message bot">
          <div class="line-bubble">
            ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸã‚’å—ã‘å–ã‚Šã¾ã—ãŸï¼<br><br>
            ãã‚Œã§ã¯ç‰‡ä»˜ã‘ã‚¹ã‚¿ãƒ¼ãƒˆï¼ğŸ’ª<br>
            çµ‚ã‚ã£ãŸã‚‰<strong>ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸ</strong>ã‚’é€ã£ã¦ãã ã•ã„
          </div>
        </div>

        <div class="line-message user">
          <div class="line-bubble">
            ğŸ“· [ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸ]
          </div>
        </div>

        <div class="line-message bot">
          <div class="line-bubble">
            ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ğŸ‰<br><br>
            ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã‚’å—ã‘å–ã‚Šã¾ã—ãŸï¼<br><br>
            è¬›å¸«ãŒç¢ºèªå¾Œã€å®Œäº†é€šçŸ¥ã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚<br>
            <span style="font-size: 0.85rem; color: #888;">ï¼ˆé€šå¸¸ç¿Œæœã¾ã§ã«ç¢ºèªã—ã¾ã™ï¼‰</span>
          </div>
        </div>

        <!-- è¬›å¸«ãƒã‚§ãƒƒã‚¯å¾Œ -->
        <div style="text-align: center; padding: 15px 0; color: #888; font-size: 0.8rem;">
          â”€â”€ è¬›å¸«ãŒãƒã‚§ãƒƒã‚¯å¾Œ â”€â”€
        </div>

        <div class="line-message bot">
          <div class="line-bubble" style="background: #f5f5f5; border: 1px solid #1a1a1a;">
            <strong>OK</strong><br><br>
            ã‚­ãƒƒãƒãƒ³ã®ç‰‡ä»˜ã‘ã€ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼<br>
            ã¨ã¦ã‚‚ã‚¹ãƒƒã‚­ãƒªã—ã¾ã—ãŸã­<br><br>
            ã“ã‚Œã§<strong>4/8ç®‡æ‰€</strong>å®Œäº†ã§ã™ï¼<br>
            æ¬¡ã®ç‰‡ä»˜ã‘ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼
          </div>
        </div>

        <div class="line-message bot">
          <div class="line-bubble">
            æ¬¡ã®äºˆå®šã¯<br>
            <strong>ğŸš¿ æ´—é¢æ‰€ãƒ»æµ´å®¤</strong><br>
            <strong style="color: #1a1a1a;">1æœˆ11æ—¥ï¼ˆåœŸï¼‰10:00ã€œ</strong><br><br>
            å‰æ—¥ã«ã¾ãŸãƒªãƒã‚¤ãƒ³ãƒ‰ã—ã¾ã™ã­ï¼
          </div>
          <div class="line-buttons">
            <div class="line-btn">äºˆå®šã‚’ç¢ºèªã™ã‚‹</div>
            <div class="line-btn">æ—¥ç¨‹ã‚’å¤‰æ›´ã—ãŸã„</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top: 20px;">
      <div class="card-title">ç‰‡ä»˜ã‘å®Œäº†ã¾ã§ã®æµã‚Œ</div>
      <div style="margin-top: 15px;">
        <div style="display: flex; align-items: center; margin-bottom: 12px;">
          <div style="width: 24px; height: 24px; background: #1a1a1a; color: white; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 400; margin-right: 10px;">1</div>
          <span style="font-size: 0.9rem;">ç”Ÿå¾’ãŒ<strong>ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸ</strong>ã‚’é€ä¿¡</span>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 12px;">
          <div style="width: 24px; height: 24px; background: #1a1a1a; color: white; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 400; margin-right: 10px;">2</div>
          <span style="font-size: 0.9rem;">ç‰‡ä»˜ã‘ã‚’å®Ÿè¡Œ</span>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 12px;">
          <div style="width: 24px; height: 24px; background: #1a1a1a; color: white; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 400; margin-right: 10px;">3</div>
          <span style="font-size: 0.9rem;">ç”Ÿå¾’ãŒ<strong>ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸ</strong>ã‚’é€ä¿¡ â†’ <span style="color: #888;">ä¸€æ™‚å®Œäº†</span></span>
        </div>
        <div style="display: flex; align-items: center; margin-bottom: 12px;">
          <div style="width: 24px; height: 24px; background: #f5f5f5; color: #1a1a1a; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 400; margin-right: 10px; border: 1px solid #1a1a1a;">4</div>
          <span style="font-size: 0.9rem;"><strong>è¬›å¸«ãŒç¿Œæœãƒã‚§ãƒƒã‚¯</strong>ã—ã¦OK</span>
        </div>
        <div style="display: flex; align-items: center;">
          <div style="width: 24px; height: 24px; background: #000; color: white; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 400; margin-right: 10px;">âœ“</div>
          <span style="font-size: 0.9rem;">ç”Ÿå¾’ã«å®Œäº†é€šçŸ¥ â†’ <span style="color: #1a1a1a; font-weight: 500;">æ­£å¼å®Œäº†</span></span>
        </div>
      </div>
    </div>
  </section>

  <!-- APIæ¥ç¶š -->
  <script src="/scripts/api.js"></script>

  <script>
    // ç¾åœ¨ã®å½¹å‰²
    let currentRole = 'student';

    // ========================================
    // ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç†
    // ========================================
    const wizardState = {
      selectedLocations: [], // { location: string, locationIcon: string, dataLocation: string }
      schedules: [] // { location, locationIcon, startTime, endTime }
    };

    // é¸æŠã•ã‚ŒãŸå ´æ‰€ã‚’å–å¾—ã—ã¦çŠ¶æ…‹ã‚’æ›´æ–°
    function updateSelectedLocations() {
      const selectedOptions = document.querySelectorAll('.location-option.selected');
      wizardState.selectedLocations = [];

      selectedOptions.forEach(option => {
        const dataLocation = option.getAttribute('data-location');
        const icon = option.querySelector('.loc-icon').textContent.trim();
        const name = option.querySelector('.loc-name').textContent.trim();

        // ãã®ä»–ã®å ´åˆã¯ã‚«ã‚¹ã‚¿ãƒ å…¥åŠ›ã‚’ä½¿ç”¨
        if (dataLocation === 'other') {
          const customInput = document.querySelector('#customInput input');
          const customName = customInput ? customInput.value.trim() : '';
          if (customName) {
            wizardState.selectedLocations.push({
              location: customName,
              locationIcon: 'âœï¸',
              dataLocation: 'other'
            });
          }
        } else {
          wizardState.selectedLocations.push({
            location: name,
            locationIcon: icon,
            dataLocation: dataLocation
          });
        }
      });

      // é¸æŠæ•°ã‚’æ›´æ–°ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å†…ï¼‰
      const countEl = document.getElementById('selectedCount');
      if (countEl) {
        countEl.textContent = wizardState.selectedLocations.length + 'ç®‡æ‰€é¸æŠä¸­';
      }

      // é¸æŠæ•°ã‚’æ›´æ–°ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒãƒƒã‚¸ï¼‰
      const badgeEl = document.getElementById('selectedCountBadge');
      if (badgeEl) {
        const count = wizardState.selectedLocations.length;
        badgeEl.textContent = count + 'ç®‡æ‰€';
        badgeEl.style.background = count > 0 ? '#1a1a1a' : '#888';
      }

      // é¸æŠæ¸ˆã¿è¡¨ç¤ºã‚’æ›´æ–°
      updateSelectedLocationsDisplay();
    }

    // é¸æŠæ¸ˆã¿å ´æ‰€ã®è¡¨ç¤ºã‚’æ›´æ–°
    function updateSelectedLocationsDisplay() {
      const container = document.getElementById('selectedLocations');
      if (!container) return;

      if (wizardState.selectedLocations.length === 0) {
        container.style.display = 'none';
        return;
      }

      container.style.display = 'block';
      container.innerHTML = `
        <div style="font-weight: 500; color: #1a1a1a; margin-bottom: 8px; font-size: 0.85rem;">é¸æŠä¸­: ${wizardState.selectedLocations.length}ç®‡æ‰€</div>
        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
          ${wizardState.selectedLocations.map(loc => `
            <span style="background: white; border: 1px solid #1a1a1a; color: #1a1a1a; padding: 4px 12px; border-radius: 2px; font-size: 0.8rem; display: flex; align-items: center; gap: 6px;">
              ${loc.locationIcon} ${loc.location} <span onclick="removeSelectedLocation('${loc.dataLocation}')" style="cursor: pointer; opacity: 0.7;">Ã—</span>
            </span>
          `).join('')}
        </div>
      `;
    }

    // é¸æŠæ¸ˆã¿å ´æ‰€ã‚’å‰Šé™¤
    function removeSelectedLocation(dataLocation) {
      const option = document.querySelector(`.location-option[data-location="${dataLocation}"]`);
      if (option) {
        option.classList.remove('selected');
      }
      updateSelectedLocations();
    }

    // Step 2ã®æ—¥æ™‚è¨­å®šã‚«ãƒ¼ãƒ‰ã‚’å‹•çš„ç”Ÿæˆ
    function generateStep2Content() {
      const container = document.getElementById('step2-locations-container');
      if (!container) return;

      // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ™ãƒ¼ã‚¹ã«è¨ˆç®—
      const today = new Date();

      container.innerHTML = wizardState.selectedLocations.map((loc, index) => {
        // å„å ´æ‰€ã«1é€±é–“ãšã¤ãšã‚‰ã—ãŸæ—¥ä»˜ã‚’è¨­å®š
        const defaultDate = new Date(today);
        defaultDate.setDate(today.getDate() + (7 * (index + 1)));
        const dateStr = defaultDate.toISOString().split('T')[0];

        return `
          <div class="schedule-input-card" data-location="${loc.dataLocation}" style="border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
              <span style="font-size: 1.3rem;">${loc.locationIcon}</span>
              <span style="font-weight: 600;">${loc.location}</span>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
              <input type="date" class="schedule-date" value="${dateStr}" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; flex: 1; min-width: 140px;">
              <div style="display: flex; gap: 5px; align-items: center; flex: 1; min-width: 200px;">
                <input type="time" class="schedule-start-time" value="09:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; flex: 1;">
                <span style="color: #666;">ã€œ</span>
                <input type="time" class="schedule-end-time" value="13:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; flex: 1;">
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Step 3ã®ç¢ºèªå†…å®¹ã‚’å‹•çš„ç”Ÿæˆ
    function generateStep3Content() {
      // Step 2ã‹ã‚‰æ—¥æ™‚æƒ…å ±ã‚’åé›†
      wizardState.schedules = [];
      const cards = document.querySelectorAll('.schedule-input-card');

      cards.forEach(card => {
        const dataLocation = card.getAttribute('data-location');
        const locData = wizardState.selectedLocations.find(l => l.dataLocation === dataLocation);
        if (!locData) return;

        const dateInput = card.querySelector('.schedule-date');
        const startInput = card.querySelector('.schedule-start-time');
        const endInput = card.querySelector('.schedule-end-time');

        if (dateInput && startInput && endInput) {
          const date = dateInput.value;
          const startTime = startInput.value;
          const endTime = endInput.value;

          // ISOå½¢å¼ã«å¤‰æ›
          const startISO = new Date(`${date}T${startTime}:00`).toISOString();
          const endISO = new Date(`${date}T${endTime}:00`).toISOString();

          wizardState.schedules.push({
            location: locData.location,
            locationIcon: locData.locationIcon,
            startTime: startISO,
            endTime: endISO,
            displayDate: formatDisplayDate(date, startTime, endTime)
          });
        }
      });

      // ç¢ºèªç”»é¢ã«è¡¨ç¤º
      const container = document.getElementById('step3-confirmation-container');
      if (!container) return;

      container.innerHTML = wizardState.schedules.map(schedule => `
        <div style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
            <span>${schedule.locationIcon}</span>
            <span style="font-weight: 600; flex: 1;">${schedule.location}</span>
          </div>
          <div style="font-size: 0.9rem; color: #333; padding-left: 28px;">
            ${schedule.displayDate}
          </div>
        </div>
      `).join('');
    }

    // æ—¥ä»˜ã‚’è¡¨ç¤ºç”¨ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatDisplayDate(dateStr, startTime, endTime) {
      const date = new Date(dateStr);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      const weekday = weekdays[date.getDay()];
      return `${month}æœˆ${day}æ—¥ï¼ˆ${weekday}ï¼‰${startTime} ã€œ ${endTime}`;
    }

    // å½¹å‰²ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
    function switchRole(role) {
      currentRole = role;

      // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
      document.getElementById('role-student').classList.toggle('active', role === 'student');
      document.getElementById('role-teacher').classList.toggle('active', role === 'teacher');

      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆ
      document.getElementById('nav-student').style.display = role === 'student' ? 'flex' : 'none';
      document.getElementById('nav-teacher').style.display = role === 'teacher' ? 'flex' : 'none';

      // å„å½¹å‰²ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
      const defaultSection = role === 'student' ? 'student-task' : 'daily-tasks';
      document.querySelectorAll('.proto-section').forEach(s => s.classList.remove('active'));
      document.getElementById(defaultSection).classList.add('active');

      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
      const activeNav = document.getElementById(role === 'student' ? 'nav-student' : 'nav-teacher');
      activeNav.querySelectorAll('button').forEach((b, i) => {
        b.classList.toggle('active', i === 0);
      });

      // è¬›å¸«ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
      if (role === 'teacher') {
        loadTeacherDashboard();
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showSection(id) {
      document.querySelectorAll('.proto-section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');

      // ç¾åœ¨ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®ãƒœã‚¿ãƒ³ã®ã¿æ›´æ–°
      const activeNavId = currentRole === 'student' ? 'nav-student' : 'nav-teacher';
      document.getElementById(activeNavId).querySelectorAll('button').forEach(b => b.classList.remove('active'));
      if (event && event.target) {
        event.target.classList.add('active');
      }

      // è¬›å¸«ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã¯ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      if (id === 'daily-tasks') {
        loadTeacherDashboard();
      } else if (id === 'dashboard') {
        loadStudentsProgress();
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========================================
    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²å‡¦ç†
    // ========================================
    async function registerSchedule() {
      // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
      const user = window.scheduleAPI ? window.scheduleAPI.getCurrentUser() : null;

      if (!user) {
        alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç™»éŒ²ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
        return;
      }

      // ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
      const registerBtn = document.querySelector('#wizard-step-3 .btn-primary');
      if (registerBtn) {
        registerBtn.disabled = true;
        registerBtn.textContent = 'ç™»éŒ²ä¸­...';
      }

      try {
        // APIã«é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
        const schedulesToCreate = wizardState.schedules.map(s => ({
          location: s.location,
          locationIcon: s.locationIcon,
          startTime: s.startTime,
          endTime: s.endTime
        }));

        console.log('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±', user);

        // APIå‘¼ã³å‡ºã—ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ˜ç¤ºçš„ã«é€ä¿¡ï¼‰
        const result = await window.scheduleAPI.createSchedulesBulk(
          schedulesToCreate,
          user.id,
          user.displayName || user.name
        );

        if (result.success) {
          alert(`${result.created}ä»¶ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`);

          // ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
          wizardState.selectedLocations = [];
          wizardState.schedules = [];

          // å ´æ‰€é¸æŠã‚’ã™ã¹ã¦è§£é™¤
          document.querySelectorAll('.location-option.selected').forEach(opt => {
            opt.classList.remove('selected');
          });
          updateSelectedLocationsDisplay();

          // ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã‚’Step 1ã«ãƒªã‚»ãƒƒãƒˆ
          currentWizardStep = 1;
          goToStep(1);

          // ç™»éŒ²æ¸ˆã¿äºˆå®šã‚¿ãƒ–ã«é·ç§»
          showStudentSubtab('registered');

          // ç™»éŒ²æ¸ˆã¿äºˆå®šã‚’å†èª­ã¿è¾¼ã¿
          loadRegisteredSchedules();
        } else {
          throw new Error(result.error || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (error) {
        console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
        alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      } finally {
        // ç™»éŒ²ãƒœã‚¿ãƒ³ã‚’å¾©å…ƒ
        if (registerBtn) {
          registerBtn.disabled = false;
          registerBtn.textContent = 'ã“ã®å†…å®¹ã§ç™»éŒ²ã™ã‚‹';
        }
      }
    }

    // ç™»éŒ²æ¸ˆã¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
    async function loadRegisteredSchedules() {
      const container = document.getElementById('registered-schedules-container');
      if (!container) return;

      const user = window.scheduleAPI ? window.scheduleAPI.getCurrentUser() : null;
      if (!user) {
        container.innerHTML = '<p style="color: #666; text-align: center;">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ç™»éŒ²æ¸ˆã¿ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>';
        return;
      }

      try {
        const schedules = await window.scheduleAPI.getSchedules();

        if (schedules.length === 0) {
          container.innerHTML = '<p style="color: #666; text-align: center;">ç™»éŒ²æ¸ˆã¿ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
          return;
        }

        // ã‚½ãƒ¼ãƒˆ: å®Œäº†ã—ã¦ã„ãªã„ã‚‚ã®ã‚’ä¸Šã«ã€ãã®ä¸­ã§æ—¥ä»˜ãŒè¿‘ã„é †ã«
        // å®Œäº†ã—ãŸã‚‚ã®ã¯ä¸‹ã«ã€æ—¥ä»˜ãŒæ–°ã—ã„é †ã«
        const now = new Date();
        schedules.sort((a, b) => {
          const aFinished = a.status === 'completed' || a.status === 'cancelled';
          const bFinished = b.status === 'completed' || b.status === 'cancelled';

          // å®Œäº†ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä»¥å¤–ã‚’ä¸Šã«
          if (aFinished !== bFinished) {
            return aFinished ? 1 : -1;
          }

          const aTime = new Date(a.startTime);
          const bTime = new Date(b.startTime);

          if (!aFinished) {
            // æœªå®Œäº†: é–‹å§‹æ™‚åˆ»ãŒè¿‘ã„é †ï¼ˆæ˜‡é †ï¼‰
            return aTime - bTime;
          } else {
            // å®Œäº†ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«: æœ€è¿‘ã®ã‚‚ã®é †ï¼ˆé™é †ï¼‰
            return bTime - aTime;
          }
        });

        container.innerHTML = schedules.map(schedule => {
          const startDate = new Date(schedule.startTime);
          const endDate = new Date(schedule.endTime);
          const displayDate = formatScheduleDate(startDate, endDate);
          const icon = schedule.locationIcon || 'ğŸ“‹';
          const location = schedule.location || schedule.title || 'äºˆå®š';

          // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ãŸè¡¨ç¤º
          const status = schedule.status || 'scheduled';
          let statusBadge = '';
          let actionButton = '';
          let borderColor = '#e0e0e0';

          if (status === 'completed') {
            statusBadge = '<span style="background: #1a1a1a; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">å®Œäº†</span>';
            borderColor = '#1a1a1a';
          } else if (status === 'cancelled') {
            statusBadge = '<span style="background: #9ca3af; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>';
            borderColor = '#9ca3af';
          } else if (status === 'pending_approval') {
            statusBadge = '<span style="background: #059669; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">ç¢ºèªå¾…ã¡</span>';
            borderColor = '#059669';
          } else if (status === 'before_submitted') {
            statusBadge = '<span style="background: #f59e0b; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">ç‰‡ä»˜ã‘ä¸­</span>';
            actionButton = `
              <button class="btn btn-primary btn-sm" style="width: 100%; margin-top: 10px;" onclick="submitAfterPhotoFromUI('${schedule.id}', this)">
                ğŸ“· ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã‚’é€ä¿¡
              </button>
            `;
            borderColor = '#f59e0b';
          } else {
            // scheduled
            statusBadge = '<span style="background: #f5f5f5; color: #666; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem; border: 1px solid #e0e0e0;">äºˆå®š</span>';
            actionButton = `
              <div style="margin-top: 10px;">
                <button class="btn btn-secondary btn-sm" style="width: 100%;" onclick="submitBeforePhotoFromUI('${schedule.id}', this)">
                  ğŸ“· ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸã‚’é€ä¿¡ï¼ˆç‰‡ä»˜ã‘é–‹å§‹ï¼‰
                </button>
                <div style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px;">
                  <button style="background: none; border: none; color: #888; font-size: 0.75rem; padding: 4px 8px; cursor: pointer; text-decoration: underline;" onclick="editScheduleFromUI('${schedule.id}')">
                    å¤‰æ›´
                  </button>
                  <button style="background: none; border: none; color: #999; font-size: 0.75rem; padding: 4px 8px; cursor: pointer;" onclick="cancelScheduleFromUI('${schedule.id}', this)">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            `;
          }

          return `
            <div style="background: #f8f8f8; border-radius: 10px; padding: 15px; margin-bottom: 10px; border: 2px solid ${borderColor};">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span>${icon}</span>
                  <span style="font-weight: 600;">${location}</span>
                </div>
                ${statusBadge}
              </div>
              <div style="font-size: 0.9rem; color: #666; margin-bottom: 8px; padding-left: 26px;">
                ${displayDate}
              </div>
              ${actionButton}
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        container.innerHTML = '<p style="color: #666; text-align: center;">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    // ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸé€ä¿¡ï¼ˆUIç”¨ï¼‰- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¯¾å¿œ
    async function submitBeforePhotoFromUI(scheduleId, button) {
      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.capture = 'environment'; // ã‚«ãƒ¡ãƒ©ã‚’ç›´æ¥èµ·å‹•ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰

      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const originalText = button.innerHTML;
        button.disabled = true;
        button.innerHTML = 'é€ä¿¡ä¸­...';

        try {
          const result = await window.scheduleAPI.submitBeforePhoto(scheduleId, file);

          if (result.success) {
            showSaveSuccess(button, 'ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ç‰‡ä»˜ã‘ã‚’å§‹ã‚ã¾ã—ã‚‡ã†');
            setTimeout(() => loadRegisteredSchedules(), 1000);
          } else {
            alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
            button.disabled = false;
            button.innerHTML = originalText;
          }
        } catch (error) {
          console.error('ãƒ“ãƒ•ã‚©ãƒ¼å†™çœŸé€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
          alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
          button.disabled = false;
          button.innerHTML = originalText;
        }
      };

      input.click();
    }

    // ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸé€ä¿¡ï¼ˆUIç”¨ï¼‰- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå¯¾å¿œ
    async function submitAfterPhotoFromUI(scheduleId, button) {
      // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.capture = 'environment'; // ã‚«ãƒ¡ãƒ©ã‚’ç›´æ¥èµ·å‹•ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰

      input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const originalText = button.innerHTML;
        button.disabled = true;
        button.innerHTML = 'é€ä¿¡ä¸­...';

        try {
          const result = await window.scheduleAPI.submitAfterPhoto(scheduleId, file);

          if (result.success) {
            showSaveSuccess(button, 'ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸã‚’é€ä¿¡ã—ã¾ã—ãŸï¼è¬›å¸«ã®ç¢ºèªã‚’ãŠå¾…ã¡ãã ã•ã„');
            setTimeout(() => loadRegisteredSchedules(), 1000);
          } else {
            alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
            button.disabled = false;
            button.innerHTML = originalText;
          }
        } catch (error) {
          console.error('ã‚¢ãƒ•ã‚¿ãƒ¼å†™çœŸé€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
          alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
          button.disabled = false;
          button.innerHTML = originalText;
        }
      };

      input.click();
    }

    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    async function cancelScheduleFromUI(scheduleId, button) {
      if (!confirm('ã“ã®äºˆå®šã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = 'å‡¦ç†ä¸­...';

      try {
        const result = await window.scheduleAPI.cancelSchedule(scheduleId);

        if (result.success) {
          showSaveSuccess(button, 'äºˆå®šã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
          setTimeout(() => loadRegisteredSchedules(), 1000);
        } else {
          alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
          button.disabled = false;
          button.innerHTML = originalText;
        }
      } catch (error) {
        console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ');
        button.disabled = false;
        button.innerHTML = originalText;
      }
    }

    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
    let editingScheduleId = null;
    let editingScheduleData = null;

    async function editScheduleFromUI(scheduleId) {
      try {
        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const schedules = await window.scheduleAPI.getSchedules();
        const schedule = schedules.find(s => s.id === scheduleId);

        if (!schedule) {
          alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          return;
        }

        editingScheduleId = scheduleId;
        editingScheduleData = schedule;

        // æ—¥æ™‚ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        const startDate = new Date(schedule.startTime);
        const endDate = new Date(schedule.endTime);
        const dateStr = startDate.toISOString().split('T')[0];
        const startTimeStr = `${String(startDate.getHours()).padStart(2, '0')}:${String(startDate.getMinutes()).padStart(2, '0')}`;
        const endTimeStr = `${String(endDate.getHours()).padStart(2, '0')}:${String(endDate.getMinutes()).padStart(2, '0')}`;

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½œæˆ
        const overlay = document.createElement('div');
        overlay.id = 'edit-schedule-overlay';
        overlay.style.cssText = `
          position: fixed; top: 0; left: 0; right: 0; bottom: 0;
          background: rgba(0,0,0,0.5); z-index: 10000;
          display: flex; align-items: center; justify-content: center;
          padding: 20px;
        `;

        overlay.innerHTML = `
          <div style="background: white; border-radius: 12px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto;">
            <div style="padding: 20px; border-bottom: 1px solid #eee;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0; font-size: 1.1rem;">äºˆå®šã‚’å¤‰æ›´</h3>
                <button onclick="closeEditModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #888;">&times;</button>
              </div>
            </div>
            <div style="padding: 20px;">
              <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">ç‰‡ä»˜ã‘å ´æ‰€</label>
                <select id="edit-location" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem;">
                  <option value="ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ" ${schedule.location === 'ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ' ? 'selected' : ''}>ğŸ§¥ ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ</option>
                  <option value="é´ç®±" ${schedule.location === 'é´ç®±' ? 'selected' : ''}>ğŸ‘Ÿ é´ç®±</option>
                  <option value="å†·è”µåº«" ${schedule.location === 'å†·è”µåº«' ? 'selected' : ''}>ğŸ§Š å†·è”µåº«</option>
                  <option value="ãƒ‘ãƒ³ãƒˆãƒªãƒ¼" ${schedule.location === 'ãƒ‘ãƒ³ãƒˆãƒªãƒ¼' ? 'selected' : ''}>ğŸ¥« ãƒ‘ãƒ³ãƒˆãƒªãƒ¼</option>
                  <option value="ã‚­ãƒƒãƒãƒ³" ${schedule.location === 'ã‚­ãƒƒãƒãƒ³' ? 'selected' : ''}>ğŸ³ ã‚­ãƒƒãƒãƒ³</option>
                  <option value="ãƒªãƒ“ãƒ³ã‚°" ${schedule.location === 'ãƒªãƒ“ãƒ³ã‚°' ? 'selected' : ''}>ğŸ›‹ï¸ ãƒªãƒ“ãƒ³ã‚°</option>
                  <option value="æ´—é¢æ‰€" ${schedule.location === 'æ´—é¢æ‰€' ? 'selected' : ''}>ğŸš¿ æ´—é¢æ‰€</option>
                  <option value="æ›¸é¡" ${schedule.location === 'æ›¸é¡' ? 'selected' : ''}>ğŸ“„ æ›¸é¡</option>
                  <option value="æœ¬æ£š" ${schedule.location === 'æœ¬æ£š' ? 'selected' : ''}>ğŸ“š æœ¬æ£š</option>
                  <option value="ãƒ‡ã‚¹ã‚¯å‘¨ã‚Š" ${schedule.location === 'ãƒ‡ã‚¹ã‚¯å‘¨ã‚Š' ? 'selected' : ''}>ğŸ–¥ï¸ ãƒ‡ã‚¹ã‚¯å‘¨ã‚Š</option>
                  <option value="å­ä¾›éƒ¨å±‹" ${schedule.location === 'å­ä¾›éƒ¨å±‹' ? 'selected' : ''}>ğŸ§¸ å­ä¾›éƒ¨å±‹</option>
                  <option value="ç„é–¢" ${schedule.location === 'ç„é–¢' ? 'selected' : ''}>ğŸšª ç„é–¢</option>
                </select>
              </div>
              <div style="margin-bottom: 16px;">
                <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">æ—¥ä»˜</label>
                <input type="date" id="edit-date" value="${dateStr}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;" />
              </div>
              <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                <div style="flex: 1;">
                  <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">é–‹å§‹æ™‚åˆ»</label>
                  <input type="time" id="edit-start-time" value="${startTimeStr}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;" />
                </div>
                <div style="flex: 1;">
                  <label style="display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px;">çµ‚äº†æ™‚åˆ»</label>
                  <input type="time" id="edit-end-time" value="${endTimeStr}" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; box-sizing: border-box;" />
                </div>
              </div>
              <button onclick="saveEditedSchedule()" class="btn btn-primary" style="width: 100%;">
                å¤‰æ›´ã‚’ä¿å­˜
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(overlay);
      } catch (error) {
        console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç·¨é›†ã‚¨ãƒ©ãƒ¼:', error);
        alert('ç·¨é›†ç”»é¢ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸ');
      }
    }

    function closeEditModal() {
      const overlay = document.getElementById('edit-schedule-overlay');
      if (overlay) overlay.remove();
      editingScheduleId = null;
      editingScheduleData = null;
    }

    async function saveEditedSchedule() {
      if (!editingScheduleId) return;

      const location = document.getElementById('edit-location').value;
      const dateStr = document.getElementById('edit-date').value;
      const startTimeStr = document.getElementById('edit-start-time').value;
      const endTimeStr = document.getElementById('edit-end-time').value;

      if (!dateStr || !startTimeStr || !endTimeStr) {
        alert('æ—¥æ™‚ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å ´æ‰€ã‹ã‚‰å–å¾—
      const locationIcons = {
        'ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ': 'ğŸ§¥', 'é´ç®±': 'ğŸ‘Ÿ', 'å†·è”µåº«': 'ğŸ§Š', 'ãƒ‘ãƒ³ãƒˆãƒªãƒ¼': 'ğŸ¥«',
        'ã‚­ãƒƒãƒãƒ³': 'ğŸ³', 'ãƒªãƒ“ãƒ³ã‚°': 'ğŸ›‹ï¸', 'æ´—é¢æ‰€': 'ğŸš¿', 'æ›¸é¡': 'ğŸ“„',
        'æœ¬æ£š': 'ğŸ“š', 'ãƒ‡ã‚¹ã‚¯å‘¨ã‚Š': 'ğŸ–¥ï¸', 'å­ä¾›éƒ¨å±‹': 'ğŸ§¸', 'ç„é–¢': 'ğŸšª'
      };

      const startTime = new Date(`${dateStr}T${startTimeStr}`);
      const endTime = new Date(`${dateStr}T${endTimeStr}`);

      try {
        const result = await window.scheduleAPI.updateSchedule(editingScheduleId, {
          location: location,
          locationIcon: locationIcons[location] || 'ğŸ“‹',
          title: location,
          startTime: startTime.toISOString(),
          endTime: endTime.toISOString()
        });

        if (result.success) {
          closeEditModal();
          showSaveSuccess(document.body, 'äºˆå®šã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
          loadRegisteredSchedules();
        } else {
          alert('å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
        }
      } catch (error) {
        console.error('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        alert('å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatScheduleDate(start, end) {
      const month = start.getMonth() + 1;
      const day = start.getDate();
      const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      const weekday = weekdays[start.getDay()];
      const startTime = `${start.getHours()}:${String(start.getMinutes()).padStart(2, '0')}`;
      const endTime = `${end.getHours()}:${String(end.getMinutes()).padStart(2, '0')}`;
      return `${month}æœˆ${day}æ—¥ï¼ˆ${weekday}ï¼‰${startTime}ã€œ${endTime}`;
    }

    // ========================================
    // ç”Ÿå¾’ç”¨ã‚µãƒ–ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    // ========================================
    function showStudentSubtab(tabName) {
      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åˆ‡ã‚Šæ›¿ãˆ
      document.getElementById('student-subtab-new').style.display = tabName === 'new' ? 'block' : 'none';
      document.getElementById('student-subtab-registered').style.display = tabName === 'registered' ? 'block' : 'none';

      // ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
      const newTab = document.getElementById('subtab-new');
      const registeredTab = document.getElementById('subtab-registered');

      if (tabName === 'new') {
        newTab.style.borderBottomColor = '#1a1a1a';
        newTab.style.fontWeight = '500';
        newTab.style.color = '#1a1a1a';
        registeredTab.style.borderBottomColor = 'transparent';
        registeredTab.style.fontWeight = '400';
        registeredTab.style.color = '#888';
      } else {
        registeredTab.style.borderBottomColor = '#1a1a1a';
        registeredTab.style.fontWeight = '500';
        registeredTab.style.color = '#1a1a1a';
        newTab.style.borderBottomColor = 'transparent';
        newTab.style.fontWeight = '400';
        newTab.style.color = '#888';

        // ç™»éŒ²æ¸ˆã¿ã‚¿ãƒ–è¡¨ç¤ºæ™‚ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’èª­ã¿è¾¼ã¿
        loadRegisteredSchedules();
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ========================================
    // ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ ã‚¹ãƒ†ãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    // ========================================
    let currentWizardStep = 1;

    function goToStep(stepNumber) {
      // Step 1ã‹ã‚‰Step 2ã¸ç§»å‹•æ™‚ï¼šé¸æŠå ´æ‰€ã‚’å–å¾—ã—ã¦Step 2ã‚’ç”Ÿæˆ
      if (currentWizardStep === 1 && stepNumber === 2) {
        updateSelectedLocations();
        if (wizardState.selectedLocations.length === 0) {
          alert('ç‰‡ä»˜ã‘ã‚‹å ´æ‰€ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        generateStep2Content();
      }

      // Step 2ã‹ã‚‰Step 3ã¸ç§»å‹•æ™‚ï¼šæ—¥æ™‚æƒ…å ±ã‚’åé›†ã—ã¦Step 3ã‚’ç”Ÿæˆ
      if (currentWizardStep === 2 && stepNumber === 3) {
        generateStep3Content();
      }

      currentWizardStep = stepNumber;

      // å…¨ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤º
      document.querySelectorAll('.wizard-step').forEach(step => {
        step.style.display = 'none';
      });

      // æŒ‡å®šã‚¹ãƒ†ãƒƒãƒ—ã‚’è¡¨ç¤º
      const targetStep = document.getElementById('wizard-step-' + stepNumber);
      if (targetStep) {
        targetStep.style.display = 'block';
      }

      // ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’æ›´æ–°
      document.querySelectorAll('.step-dot').forEach((dot, index) => {
        const dotStep = index + 1;
        if (dotStep === stepNumber) {
          dot.style.background = '#1a1a1a';
        } else if (dotStep < stepNumber) {
          dot.style.background = '#1a1a1a';
        } else {
          dot.style.background = '#e0e0e0';
        }
      });

      // ä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // é †èª¿ãªç”Ÿå¾’ãƒªã‚¹ãƒˆã®æŠ˜ã‚ŠãŸãŸã¿
    function toggleGoodStudents() {
      const list = document.getElementById('good-students-list');
      const toggle = document.getElementById('good-students-toggle');
      if (list.style.display === 'none') {
        list.style.display = 'block';
        toggle.style.transform = 'rotate(90deg)';
      } else {
        list.style.display = 'none';
        toggle.style.transform = 'rotate(0deg)';
      }
    }

    // ç”Ÿå¾’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
    function filterStudents(type) {
      alert('ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼: ' + (type === 'warning' ? 'è¦ãƒ•ã‚©ãƒ­ãƒ¼' : type === 'stale' ? 'åœæ»ä¸­' : 'å…¨å“¡') + ' ã‚’è¡¨ç¤º');
    }

    // è¨­å®šç”»é¢ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³
    function toggleAccordion(name) {
      const content = document.getElementById('accordion-' + name + '-content');
      const toggle = document.getElementById('accordion-' + name + '-toggle');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        toggle.style.transform = 'rotate(90deg)';
      } else {
        content.style.display = 'none';
        toggle.style.transform = 'rotate(0deg)';
      }
    }

    // å ´æ‰€é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®é–‹é–‰
    let dropdownOpen = true;
    function toggleLocationDropdown() {
      const list = document.getElementById('locationList');
      const arrow = document.getElementById('dropdownArrow');
      dropdownOpen = !dropdownOpen;
      list.style.display = dropdownOpen ? 'block' : 'none';
      arrow.style.transform = dropdownOpen ? 'rotate(0deg)' : 'rotate(-90deg)';
    }

    // å ´æ‰€é¸æŠã®åˆ‡ã‚Šæ›¿ãˆ
    document.querySelectorAll('.location-option').forEach(option => {
      option.addEventListener('click', function() {
        this.classList.toggle('selected');

        // ãã®ä»–é¸æŠæ™‚ã®å…¥åŠ›æ¬„è¡¨ç¤º
        if (this.classList.contains('other-option')) {
          const customInput = document.getElementById('customInput');
          customInput.style.display = this.classList.contains('selected') ? 'block' : 'none';
        }

        // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
        updateSelectedLocations();
      });
    });

    // é¸æŠè§£é™¤
    function removeLocation(btn) {
      btn.parentElement.remove();
      // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯å¯¾å¿œã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®selectedã‚‚è§£é™¤ã™ã‚‹
    }

    // å ´æ‰€ã®è¤‡æ•°é¸æŠï¼ˆmulti-selectï¼‰
    document.querySelectorAll('.template-item.multi-select').forEach(item => {
      item.addEventListener('click', function() {
        this.classList.toggle('selected');

        // ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã®è¡¨ç¤º/éè¡¨ç¤º
        const checkMark = this.querySelector('.check-mark');
        if (checkMark) {
          checkMark.style.opacity = this.classList.contains('selected') ? '1' : '0';
        }

        // ã€Œãã®ä»–ã€é¸æŠæ™‚ã¯å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
        const customInput = document.getElementById('customInput');
        if (this.classList.contains('other-option')) {
          customInput.style.display = this.classList.contains('selected') ? 'block' : 'none';
        }
      });
    });

    // ãƒªãƒã‚¤ãƒ³ãƒ‰ãƒãƒƒãƒ—é¸æŠï¼ˆON/OFFåˆ‡ã‚Šæ›¿ãˆï¼‰
    document.querySelectorAll('.remind-chip').forEach(chip => {
      chip.addEventListener('click', function() {
        this.classList.toggle('active');
        this.textContent = this.classList.contains('active') ? 'ON' : 'OFF';
      });
    });

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†ãƒˆã‚°ãƒ«
    function toggleEdit(button) {
      const container = button.closest('.message-template-item');
      const textarea = container.querySelector('textarea');

      if (textarea.disabled) {
        // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
        textarea.disabled = false;
        textarea.style.borderColor = '#1a1a1a';
        textarea.style.background = '#fff';
        textarea.focus();
        button.textContent = 'ä¿å­˜';
        button.style.background = '#1a1a1a';
        button.style.color = 'white';
      } else {
        // ä¿å­˜ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
        textarea.disabled = true;
        textarea.style.borderColor = '#ddd';
        textarea.style.background = '';
        button.textContent = 'ç·¨é›†';
        button.style.background = '';
        button.style.color = '';
        // ä¿å­˜ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
        showSaveSuccess(container, 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      }
    }

    // ä¿å­˜æˆåŠŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
    function showSaveSuccess(targetElement, message) {
      // æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å‰Šé™¤
      const existingFeedback = document.querySelector('.save-feedback');
      if (existingFeedback) existingFeedback.remove();

      // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¦ç´ ä½œæˆ
      const feedback = document.createElement('div');
      feedback.className = 'save-feedback';
      feedback.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: #1a1a1a;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 0.9rem;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        animation: slideUp 0.3s ease;
      `;
      feedback.innerHTML = `<span style="color: #4ade80;">âœ“</span> ${message}`;
      document.body.appendChild(feedback);

      // 2ç§’å¾Œã«æ¶ˆãˆã‚‹
      setTimeout(() => {
        feedback.style.animation = 'slideDown 0.3s ease';
        setTimeout(() => feedback.remove(), 300);
      }, 2000);
    }

    // ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šä¿å­˜
    function saveRemindSettings(button) {
      const originalText = button.textContent;
      button.disabled = true;
      button.textContent = 'ä¿å­˜ä¸­...';

      // ä¿å­˜å‡¦ç†ï¼ˆå®Ÿéš›ã®APIã¯ã“ã“ã§å‘¼ã¶ï¼‰
      setTimeout(() => {
        button.textContent = 'âœ“ ä¿å­˜ã—ã¾ã—ãŸ';
        button.style.background = '#059669';

        setTimeout(() => {
          button.disabled = false;
          button.textContent = originalText;
          button.style.background = '';
        }, 2000);

        showSaveSuccess(button, 'ãƒªãƒã‚¤ãƒ³ãƒ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      }, 500);
    }

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå…¨ä¿å­˜
    function saveMessageTemplates(button) {
      const originalText = button.textContent;
      button.disabled = true;
      button.textContent = 'ä¿å­˜ä¸­...';

      // ä¿å­˜å‡¦ç†ï¼ˆå®Ÿéš›ã®APIã¯ã“ã“ã§å‘¼ã¶ï¼‰
      setTimeout(() => {
        button.textContent = 'âœ“ ä¿å­˜ã—ã¾ã—ãŸ';
        button.style.background = '#059669';

        setTimeout(() => {
          button.disabled = false;
          button.textContent = originalText;
          button.style.background = '';
        }, 2000);

        showSaveSuccess(button, 'å…¨ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      }, 500);
    }

    // ãƒªãƒã‚¤ãƒ³ãƒ‰ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¿½åŠ 
    function addRemindTiming() {
      const list = document.getElementById('remindTimingList');
      const newItem = document.createElement('div');
      newItem.className = 'remind-timing-item';
      newItem.style.cssText = 'display: flex; align-items: center; gap: 10px; padding: 12px; background: #f8f8f8; border-radius: 8px; margin-bottom: 10px;';
      newItem.innerHTML = `
        <div style="flex: 1;">
          <select style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; margin-right: 8px;">
            <option value="before">å‰æ—¥</option>
            <option value="same">å½“æ—¥</option>
            <option value="minutes">ã€‡åˆ†å‰</option>
            <option value="hours">ã€‡æ™‚é–“å‰</option>
          </select>
          <input type="time" value="12:00" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
        </div>
        <span class="remind-chip active" style="cursor: default;">ON</span>
        <button class="btn btn-sm" style="background: #fee2e2; color: #dc2626;" onclick="this.parentElement.remove()">å‰Šé™¤</button>
      `;
      list.appendChild(newItem);
    }

    // å†™çœŸãƒã‚§ãƒƒã‚¯OK
    function approvePhoto(button) {
      const container = button.closest('div[style*="border: 1px solid"]');
      const badge = container.querySelector('span[style*="f5f5f5"]');

      // ãƒãƒƒã‚¸ã‚’å¤‰æ›´
      if (badge) {
        badge.style.background = '#1a1a1a';
        badge.style.color = '#fff';
        badge.style.border = 'none';
        badge.textContent = 'å®Œäº†';
      }

      // ãƒœã‚¿ãƒ³ã‚’å¤‰æ›´
      button.textContent = 'OKæ¸ˆã¿';
      button.disabled = true;
      button.style.background = '#f5f5f5';
      button.style.color = '#666';

      // ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
      container.style.borderColor = '#1a1a1a';
      container.style.background = '#fafafa';

      // é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      alert('OKã—ã¾ã—ãŸã€‚ç”Ÿå¾’ã«å®Œäº†é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚');
    }

    // ========================================
    // è¬›å¸«ç”¨ï¼šã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    // ========================================
    async function loadTeacherDashboard() {
      const user = window.scheduleAPI ? window.scheduleAPI.getCurrentUser() : null;
      if (!user || user.role !== 'teacher') return;

      try {
        const schedules = await window.scheduleAPI.getSchedules();

        // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¡¨ç¤º
        const today = new Date();
        const todayStr = today.toISOString().split('T')[0];
        document.getElementById('today-date-display').textContent =
          `${today.getFullYear()}.${String(today.getMonth() + 1).padStart(2, '0')}.${String(today.getDate()).padStart(2, '0')}`;

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ†é¡
        const todaySchedules = [];
        const overdueSchedules = [];
        const upcomingSchedules = [];

        schedules.forEach(schedule => {
          const startDate = new Date(schedule.startTime);
          const scheduleDate = startDate.toISOString().split('T')[0];
          const status = schedule.status || 'scheduled';

          if (scheduleDate === todayStr && status !== 'completed' && status !== 'cancelled') {
            todaySchedules.push(schedule);
          } else if (startDate < today && status === 'scheduled') {
            // è¦ãƒ•ã‚©ãƒ­ãƒ¼: éå»ã®æ—¥ä»˜ã§ã¾ã é–‹å§‹ã•ã‚Œã¦ã„ãªã„äºˆå®šã®ã¿
            // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¾Œ24æ™‚é–“ä»¥å†…ã¯éè¡¨ç¤º
            if (schedule.followupMessages && schedule.followupMessages.length > 0) {
              const lastMessage = schedule.followupMessages[schedule.followupMessages.length - 1];
              const sentAt = lastMessage.sentAt?._seconds
                ? new Date(lastMessage.sentAt._seconds * 1000)
                : new Date(lastMessage.sentAt);
              const hoursSinceSent = (Date.now() - sentAt.getTime()) / (1000 * 60 * 60);

              // 24æ™‚é–“ä»¥å†…ã«é€ä¿¡ã—ãŸå ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã‚¿ã‚¹ã‚¯ã‹ã‚‰æ¶ˆã™ï¼‰
              if (hoursSinceSent < 24) {
                return; // ã“ã®äºˆå®šã¯overdueã«è¿½åŠ ã—ãªã„
              }
              // 24æ™‚é–“ä»¥ä¸ŠçµŒéã—ãŸå ´åˆã¯å†åº¦ã‚¿ã‚¹ã‚¯åŒ–
            }
            overdueSchedules.push(schedule);
          } else if (startDate > today && status !== 'completed' && status !== 'cancelled') {
            upcomingSchedules.push(schedule);
          }
        });

        // ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
        document.getElementById('today-scheduled-count').textContent = todaySchedules.length;
        document.getElementById('overdue-count').textContent = overdueSchedules.length;

        // æœ¬æ—¥ã®äºˆå®šã‚’è¡¨ç¤º
        renderTodaySchedules(todaySchedules);

        // è¦ãƒ•ã‚©ãƒ­ãƒ¼ï¼ˆæœŸé™åˆ‡ã‚Œï¼‰ã‚’è¡¨ç¤º
        renderOverdueSchedules(overdueSchedules);

        // æ‰¿èªå¾…ã¡å†™çœŸã‚’èª­ã¿è¾¼ã¿
        await loadPendingPhotos();

      } catch (error) {
        console.error('è¬›å¸«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // æ‰¿èªå¾…ã¡å†™çœŸã‚’èª­ã¿è¾¼ã¿
    async function loadPendingPhotos() {
      try {
        const result = await window.scheduleAPI.getPendingPhotos();

        const card = document.getElementById('pending-photos-card');
        const container = document.getElementById('pending-photos-container');
        const badge = document.getElementById('pending-photos-badge');
        const countEl = document.getElementById('pending-photos-count');

        if (!result.success || !result.data || result.data.length === 0) {
          card.style.display = 'none';
          countEl.textContent = '0';
          return;
        }

        const pendingItems = result.data;
        card.style.display = 'block';
        badge.textContent = pendingItems.length + 'ä»¶';
        countEl.textContent = pendingItems.length;

        container.innerHTML = pendingItems.map(item => {
          const icon = item.locationIcon || 'ğŸ“‹';
          const location = item.location || item.title || 'å ´æ‰€ä¸æ˜';
          const studentName = item.studentName || 'ç”Ÿå¾’ä¸æ˜';
          // Firestoreã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—å½¢å¼ã«å¯¾å¿œ
          const parseTimestamp = (ts) => {
            if (!ts) return null;
            if (ts._seconds) return new Date(ts._seconds * 1000);
            if (ts.seconds) return new Date(ts.seconds * 1000);
            return new Date(ts);
          };
          const beforeTime = item.beforePhoto?.submittedAt ? parseTimestamp(item.beforePhoto.submittedAt).toLocaleString('ja-JP') : '';
          const afterTime = item.afterPhoto?.submittedAt ? parseTimestamp(item.afterPhoto.submittedAt).toLocaleString('ja-JP') : '';

          // å†™çœŸã®URLï¼ˆLINEçµŒç”±ã‹ã©ã†ã‹ã§åˆ†å²ï¼‰
          const beforePhotoSrc = item.beforePhoto?.lineMessageId
            ? `/api/photos/line-image/${item.beforePhoto.lineMessageId}`
            : (item.beforePhoto?.url || '');
          const afterPhotoSrc = item.afterPhoto?.lineMessageId
            ? `/api/photos/line-image/${item.afterPhoto.lineMessageId}`
            : (item.afterPhoto?.url || '');

          return `
            <div style="border: 2px solid #059669; border-radius: 8px; padding: 16px; margin-bottom: 12px; background: #f0fdf4;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div>
                  <div style="font-weight: 600; color: #1a1a1a;">${studentName}</div>
                  <div style="font-size: 0.85rem; color: #666;">${icon} ${location}</div>
                </div>
                <span style="background: #059669; color: #fff; padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">æ‰¿èªå¾…ã¡</span>
              </div>

              <div style="display: flex; gap: 10px; margin-bottom: 12px;">
                <div style="flex: 1; background: white; border-radius: 6px; padding: 10px; border: 1px solid #e0e0e0;">
                  <div style="font-size: 0.75rem; color: #666; margin-bottom: 4px;">ãƒ“ãƒ•ã‚©ãƒ¼</div>
                  ${beforePhotoSrc ? `
                    <img src="${beforePhotoSrc}"
                         style="width: 100%; height: 120px; object-fit: cover; border-radius: 4px; cursor: pointer;"
                         onclick="showPhotoPopup('${beforePhotoSrc}')"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div style="background: #f5f5f5; border-radius: 4px; height: 80px; display: none; align-items: center; justify-content: center; color: #888; font-size: 0.8rem;">
                      ğŸ“· èª­è¾¼å¤±æ•—
                    </div>
                  ` : `
                    <div style="background: #f5f5f5; border-radius: 4px; height: 80px; display: flex; align-items: center; justify-content: center; color: #888; font-size: 0.8rem;">
                      ğŸ“· å†™çœŸãªã—
                    </div>
                  `}
                  <div style="font-size: 0.7rem; color: #888; margin-top: 4px;">${beforeTime}</div>
                </div>
                <div style="flex: 1; background: white; border-radius: 6px; padding: 10px; border: 1px solid #e0e0e0;">
                  <div style="font-size: 0.75rem; color: #666; margin-bottom: 4px;">ã‚¢ãƒ•ã‚¿ãƒ¼</div>
                  ${afterPhotoSrc ? `
                    <img src="${afterPhotoSrc}"
                         style="width: 100%; height: 120px; object-fit: cover; border-radius: 4px; cursor: pointer;"
                         onclick="showPhotoPopup('${afterPhotoSrc}')"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div style="background: #f5f5f5; border-radius: 4px; height: 80px; display: none; align-items: center; justify-content: center; color: #888; font-size: 0.8rem;">
                      ğŸ“· èª­è¾¼å¤±æ•—
                    </div>
                  ` : `
                    <div style="background: #f5f5f5; border-radius: 4px; height: 80px; display: flex; align-items: center; justify-content: center; color: #888; font-size: 0.8rem;">
                      ğŸ“· å†™çœŸãªã—
                    </div>
                  `}
                  <div style="font-size: 0.7rem; color: #888; margin-top: 4px;">${afterTime}</div>
                </div>
              </div>

              <!-- å®šå‹æ–‡ã‚³ãƒ¡ãƒ³ãƒˆé¸æŠ -->
              <div style="margin-bottom: 10px;">
                <div style="font-size: 0.75rem; color: #666; margin-bottom: 6px;">ã‚³ãƒ¡ãƒ³ãƒˆã‚’é¸æŠï¼ˆä»»æ„ï¼‰:</div>
                <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px;">
                  <button type="button" class="preset-comment-btn" data-schedule="${item.id}"
                    style="padding: 6px 12px; font-size: 0.75rem; border: 1px solid #059669; background: white; color: #059669; border-radius: 16px; cursor: pointer;"
                    onclick="selectPresetComment('${item.id}', 'ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸï¼', this)">
                    ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸï¼
                  </button>
                  <button type="button" class="preset-comment-btn" data-schedule="${item.id}"
                    style="padding: 6px 12px; font-size: 0.75rem; border: 1px solid #059669; background: white; color: #059669; border-radius: 16px; cursor: pointer;"
                    onclick="selectPresetComment('${item.id}', 'ã™ã£ãã‚Šã—ã¾ã—ãŸã­ï¼', this)">
                    ã™ã£ãã‚Šã—ã¾ã—ãŸã­ï¼
                  </button>
                  <button type="button" class="preset-comment-btn" data-schedule="${item.id}"
                    style="padding: 6px 12px; font-size: 0.75rem; border: 1px solid #059669; background: white; color: #059669; border-radius: 16px; cursor: pointer;"
                    onclick="selectPresetComment('${item.id}', 'ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ï¼', this)">
                    ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ï¼
                  </button>
                  <button type="button" class="preset-comment-btn" data-schedule="${item.id}"
                    style="padding: 6px 12px; font-size: 0.75rem; border: 1px solid #059669; background: white; color: #059669; border-radius: 16px; cursor: pointer;"
                    onclick="selectPresetComment('${item.id}', 'ç´ æ™´ã‚‰ã—ã„å¤‰åŒ–ã§ã™ã­ï¼', this)">
                    ç´ æ™´ã‚‰ã—ã„å¤‰åŒ–ã§ã™ã­ï¼
                  </button>
                </div>
                <input type="text" id="approval-comment-${item.id}" placeholder="ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."
                       style="width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.85rem; box-sizing: border-box;" />
              </div>

              <button class="btn btn-success" style="width: 100%;" onclick="handlePhotoApproval('${item.id}', this)">
                âœ“ OKã™ã‚‹
              </button>
            </div>
          `;
        }).join('');

      } catch (error) {
        console.error('æ‰¿èªå¾…ã¡å†™çœŸèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('pending-photos-count').textContent = '0';
      }
    }

    // å®šå‹æ–‡é¸æŠ
    function selectPresetComment(scheduleId, comment, button) {
      const input = document.getElementById('approval-comment-' + scheduleId);
      if (input) {
        input.value = comment;
      }
      // é¸æŠçŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«
      const allBtns = document.querySelectorAll(`.preset-comment-btn[data-schedule="${scheduleId}"]`);
      allBtns.forEach(btn => {
        btn.style.background = 'white';
        btn.style.color = '#059669';
      });
      // åŒã˜ãƒœã‚¿ãƒ³ã‚’å†ã‚¯ãƒªãƒƒã‚¯ã§è§£é™¤
      if (input.value === comment && button.style.background !== 'white') {
        input.value = '';
        button.style.background = 'white';
        button.style.color = '#059669';
      } else {
        button.style.background = '#059669';
        button.style.color = 'white';
      }
    }

    // å†™çœŸæ‰¿èªå‡¦ç†
    async function handlePhotoApproval(scheduleId, button) {
      const originalText = button.textContent;
      button.disabled = true;
      button.textContent = 'å‡¦ç†ä¸­...';

      // ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
      const commentInput = document.getElementById('approval-comment-' + scheduleId);
      const comment = commentInput?.value?.trim() || '';

      try {
        const result = await window.scheduleAPI.approvePhoto(scheduleId, comment);

        if (result.success) {
          // æˆåŠŸã—ãŸã‚‰è¦ªè¦ç´ ã‚’éè¡¨ç¤ºã«
          const card = button.closest('div[style*="border: 2px solid #059669"]');
          card.style.opacity = '0.5';
          card.innerHTML = `
            <div style="text-align: center; padding: 20px; color: #059669;">
              <div style="font-size: 1.5rem; margin-bottom: 8px;">âœ“</div>
              <div style="font-weight: 500;">æ‰¿èªå®Œäº†</div>
              <div style="font-size: 0.8rem; color: #666;">ç”Ÿå¾’ã«å®Œäº†é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸ</div>
            </div>
          `;

          // ã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
          const countEl = document.getElementById('pending-photos-count');
          const currentCount = parseInt(countEl.textContent) || 0;
          countEl.textContent = Math.max(0, currentCount - 1);

          showSaveSuccess(card, 'å†™çœŸã‚’æ‰¿èªã—ã¾ã—ãŸ');
        } else {
          alert('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
          button.disabled = false;
          button.textContent = originalText;
        }
      } catch (error) {
        console.error('å†™çœŸæ‰¿èªã‚¨ãƒ©ãƒ¼:', error);
        alert('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ');
        button.disabled = false;
        button.textContent = originalText;
      }
    }

    function renderTodaySchedules(schedules) {
      const container = document.getElementById('today-schedules-container');
      const badge = document.getElementById('today-schedule-badge');
      badge.textContent = schedules.length + 'ä»¶';

      if (schedules.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æœ¬æ—¥ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = schedules.map(schedule => {
        const startDate = new Date(schedule.startTime);
        const endDate = new Date(schedule.endTime);
        const timeStr = `${startDate.getHours()}:${String(startDate.getMinutes()).padStart(2, '0')}ã€œ${endDate.getHours()}:${String(endDate.getMinutes()).padStart(2, '0')}`;
        const icon = schedule.locationIcon || 'ğŸ“‹';
        const location = schedule.location || schedule.title || 'äºˆå®š';
        const studentName = schedule.studentName || 'ç”Ÿå¾’æœªè¨­å®š';
        const status = schedule.status === 'completed' ? 'å®Œäº†' : 'äºˆå®š';
        const statusStyle = schedule.status === 'completed'
          ? 'background: #1a1a1a; color: #fff;'
          : 'background: #f5f5f5; color: #666; border: 1px solid #e0e0e0;';

        return `
          <div style="border: 1px solid #e0e0e0; border-radius: 4px; padding: 15px; margin-bottom: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div>
                <div style="font-weight: 500;">${studentName}</div>
                <div style="font-size: 0.85rem; color: #666;">${icon} ${location}</div>
              </div>
              <span style="${statusStyle} padding: 4px 10px; border-radius: 2px; font-size: 0.7rem;">${status}</span>
            </div>
            <div style="font-size: 0.85rem; color: #888;">${timeStr}</div>
          </div>
        `;
      }).join('');
    }

    function renderOverdueSchedules(schedules) {
      const container = document.getElementById('overdue-schedules-container');
      const badge = document.getElementById('overdue-badge');
      badge.textContent = schedules.length + 'ä»¶';

      if (schedules.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">æœŸé™åˆ‡ã‚Œã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      container.innerHTML = schedules.map(schedule => {
        const startDate = new Date(schedule.startTime);
        const dateStr = `${startDate.getMonth() + 1}/${startDate.getDate()}`;
        const icon = schedule.locationIcon || 'ğŸ“‹';
        const location = schedule.location || schedule.title || 'äºˆå®š';
        const studentName = schedule.studentName || 'ç”Ÿå¾’æœªè¨­å®š';
        const studentId = schedule.studentId || '';

        // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—å±¥æ­´ã‚’æ§‹ç¯‰
        let historyHtml = '';
        if (schedule.followupMessages && schedule.followupMessages.length > 0) {
          const historyItems = schedule.followupMessages.map(msg => {
            const sentAt = msg.sentAt?._seconds
              ? new Date(msg.sentAt._seconds * 1000)
              : new Date(msg.sentAt);
            const dateTimeStr = sentAt.toLocaleString('ja-JP', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            return `<div style="font-size: 0.75rem; color: #666; padding: 4px 0; border-bottom: 1px dashed #e0e0e0;">
              <span style="color: #888;">${dateTimeStr}</span>: ${msg.message}
            </div>`;
          }).join('');
          historyHtml = `
            <div style="margin-bottom: 10px; background: #f5f5f5; border-radius: 4px; padding: 8px;">
              <div style="font-size: 0.7rem; color: #888; margin-bottom: 4px; font-weight: 500;">ğŸ“‹ é€ä¿¡å±¥æ­´ï¼ˆ${schedule.followupMessages.length}å›ï¼‰</div>
              ${historyItems}
            </div>
          `;
        }

        return `
          <div style="background: #fafafa; border-radius: 4px; padding: 15px; margin-bottom: 10px; border: 1px solid #1a1a1a;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <div>
                <div style="font-weight: 500;">${studentName}</div>
                <div style="font-size: 0.85rem; color: #666;">${icon} ${location}ï¼ˆ${dateStr}äºˆå®šï¼‰</div>
              </div>
              <span style="color: #1a1a1a; font-size: 0.8rem;">æœªå®Œäº†</span>
            </div>
            ${historyHtml}
            ${studentId ? `
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">
                <input type="text" id="followup-msg-${schedule.id}" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                       style="width: 100%; padding: 10px 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; margin-bottom: 8px; box-sizing: border-box;" />
                <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="sendFollowupFromUI('${studentId}', '${schedule.id}', this)">
                  ğŸ“© LINEã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
                </button>
              </div>
            ` : ''}
          </div>
        `;
      }).join('');
    }

    // ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    async function sendFollowupFromUI(studentId, scheduleId, button) {
      const input = document.getElementById('followup-msg-' + scheduleId);
      const message = input?.value?.trim();

      if (!message) {
        alert('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = 'é€ä¿¡ä¸­...';

      try {
        const result = await window.scheduleAPI.sendFollowupMessage(studentId, message, scheduleId);

        if (result.success) {
          showSaveSuccess(button, 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ');
          input.value = '';
          button.disabled = false;
          button.innerHTML = originalText;
        } else {
          alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
          button.disabled = false;
          button.innerHTML = originalText;
        }
      } catch (error) {
        console.error('ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        alert('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
        button.disabled = false;
        button.innerHTML = originalText;
      }
    }

    // ç”Ÿå¾’ã®é€²æ—ã‚’èª­ã¿è¾¼ã¿
    async function loadStudentsProgress() {
      const user = window.scheduleAPI ? window.scheduleAPI.getCurrentUser() : null;
      if (!user || user.role !== 'teacher') return;

      try {
        const schedules = await window.scheduleAPI.getSchedules();

        // ç”Ÿå¾’ã”ã¨ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’é›†è¨ˆ
        const studentMap = new Map();

        schedules.forEach(schedule => {
          const studentId = schedule.studentId || 'unknown';
          const studentName = schedule.studentName || 'ç”Ÿå¾’æœªè¨­å®š';

          if (!studentMap.has(studentId)) {
            studentMap.set(studentId, {
              id: studentId,
              name: studentName,
              schedules: [],
              completed: 0,
              total: 0
            });
          }

          const student = studentMap.get(studentId);
          student.schedules.push(schedule);
          student.total++;
          if (schedule.status === 'completed') {
            student.completed++;
          }
        });

        // çµ±è¨ˆã‚’è¨ˆç®—
        const students = Array.from(studentMap.values());
        const totalSchedules = schedules.length;
        const completedSchedules = schedules.filter(s => s.status === 'completed').length;

        // ã‚µãƒãƒªãƒ¼ã‚’æ›´æ–°
        document.getElementById('student-count').textContent = students.length;
        document.getElementById('total-schedule-count').textContent = totalSchedules;
        document.getElementById('completed-count').textContent = completedSchedules;

        // ç”Ÿå¾’ä¸€è¦§ã‚’è¡¨ç¤º
        renderStudentsProgress(students);

      } catch (error) {
        console.error('ç”Ÿå¾’é€²æ—èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    function renderStudentsProgress(students) {
      const container = document.getElementById('students-progress-container');

      if (students.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ç”Ÿå¾’ãŒã„ã¾ã›ã‚“</p>';
        return;
      }

      // é€²æ—ç‡ã§ã‚½ãƒ¼ãƒˆï¼ˆä½ã„é †ï¼‰
      students.sort((a, b) => {
        const rateA = a.total > 0 ? a.completed / a.total : 0;
        const rateB = b.total > 0 ? b.completed / b.total : 0;
        return rateA - rateB;
      });

      container.innerHTML = students.map(student => {
        const progressRate = student.total > 0 ? Math.round((student.completed / student.total) * 100) : 0;
        const today = new Date();

        // æ¬¡ã®äºˆå®šã‚’å–å¾—
        const upcomingSchedules = student.schedules
          .filter(s => new Date(s.startTime) > today && s.status !== 'completed')
          .sort((a, b) => new Date(a.startTime) - new Date(b.startTime));

        const nextSchedule = upcomingSchedules[0];
        let nextInfo = '';
        if (nextSchedule) {
          const nextDate = new Date(nextSchedule.startTime);
          const icon = nextSchedule.locationIcon || 'ğŸ“‹';
          const location = nextSchedule.location || nextSchedule.title || 'äºˆå®š';
          nextInfo = `æ¬¡å›: ${nextDate.getMonth() + 1}/${nextDate.getDate()} ${icon} ${location}`;
        } else if (student.completed === student.total && student.total > 0) {
          nextInfo = 'å…¨ã¦å®Œäº†';
        } else {
          nextInfo = 'äºˆå®šãªã—';
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
        let statusBadge = '';
        let borderStyle = 'border: 1px solid #e5e5e5;';
        if (student.completed === student.total && student.total > 0) {
          statusBadge = '<span class="student-status status-complete">å®Œäº†</span>';
          borderStyle = 'border: 2px solid #1a1a1a;';
        } else if (progressRate >= 50) {
          statusBadge = '<span class="student-status status-good">é †èª¿</span>';
        } else if (student.total > 0) {
          statusBadge = '<span class="student-status status-warning">é€²è¡Œä¸­</span>';
        }

        return `
          <div class="card" style="${borderStyle} margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 40px; height: 40px; background: #f5f5f5; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">ğŸ‘¤</div>
              <div style="flex: 1;">
                <div style="font-weight: 500; margin-bottom: 4px;">${student.name}</div>
                <div style="font-size: 0.85rem; color: #666;">${student.completed}/${student.total} å®Œäº† - ${nextInfo}</div>
              </div>
              ${statusBadge}
            </div>
            <div style="margin-top: 12px;">
              <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888; margin-bottom: 4px;">
                <span>é€²æ—</span>
                <span>${progressRate}%</span>
              </div>
              <div style="background: #f0f0f0; border-radius: 4px; height: 6px; overflow: hidden;">
                <div style="background: #1a1a1a; height: 100%; width: ${progressRate}%; transition: width 0.3s;"></div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ========================================
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
    // ========================================
    async function handleGoogleLogin() {
      const loginBtn = document.getElementById('google-login-btn');
      loginBtn.disabled = true;
      loginBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';

      try {
        const user = await window.scheduleAPI.startGoogleLogin(() => {
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒé–‰ã˜ãŸæ™‚
          loginBtn.disabled = false;
          loginBtn.innerHTML = `
            <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
            Googleã§ãƒ­ã‚°ã‚¤ãƒ³
          `;
        });

        if (user) {
          updateLoginUI(user);
        }
      } catch (error) {
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
        loginBtn.disabled = false;
        loginBtn.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
          Googleã§ãƒ­ã‚°ã‚¤ãƒ³
        `;
      }
    }

    async function handleLogout() {
      await window.scheduleAPI.logout();
      showLoggedOutUI();
    }

    function updateLoginUI(user) {
      document.getElementById('login-prompt').style.display = 'none';
      document.getElementById('logged-in-user').style.display = 'block';
      document.getElementById('user-display-name').textContent = user.displayName || user.email || 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­';

      // å½¹å‰²ã«å¿œã˜ã¦è¡¨ç¤ºã‚’åˆ¶å¾¡
      const isTeacher = user.role === 'teacher';

      // å½¹å‰²åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã¯å¸¸ã«éè¡¨ç¤ºï¼ˆãã‚Œãã‚Œã®å½¹å‰²ã®ç”»é¢ã®ã¿è¡¨ç¤ºï¼‰
      document.getElementById('role-toggle').style.display = 'none';

      // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡
      if (isTeacher) {
        // è¬›å¸«ï¼šè¬›å¸«ç®¡ç†ç”»é¢ã®ã¿è¡¨ç¤º
        document.getElementById('nav-student').style.display = 'none';
        document.getElementById('nav-teacher').style.display = 'flex';
        currentRole = 'teacher';

        // è¬›å¸«ç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
        document.querySelectorAll('.proto-section').forEach(s => s.classList.remove('active'));
        document.getElementById('daily-tasks').classList.add('active');

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿
        loadTeacherDashboard();
      } else {
        // ç”Ÿå¾’ï¼šç”Ÿå¾’ç”»é¢ã®ã¿è¡¨ç¤º
        document.getElementById('nav-student').style.display = 'flex';
        document.getElementById('nav-teacher').style.display = 'none';
        currentRole = 'student';

        // ç”Ÿå¾’ç”¨ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
        document.querySelectorAll('.proto-section').forEach(s => s.classList.remove('active'));
        document.getElementById('student-task').classList.add('active');
      }
    }

    // æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®UIè¡¨ç¤º
    function showLoggedOutUI() {
      document.getElementById('login-prompt').style.display = 'block';
      document.getElementById('logged-in-user').style.display = 'none';
      document.getElementById('role-toggle').style.display = 'none';

      // ç”Ÿå¾’ç”¨ç”»é¢ã®ã¿è¡¨ç¤ºï¼ˆãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ï¼‰
      document.getElementById('nav-student').style.display = 'flex';
      document.getElementById('nav-teacher').style.display = 'none';
      currentRole = 'student';
    }

    // ========================================
    // åˆæœŸåŒ–å‡¦ç†
    // ========================================
    document.addEventListener('DOMContentLoaded', async function() {
      // åˆæœŸé¸æŠã•ã‚Œã¦ã„ã‚‹å ´æ‰€ã‚’çŠ¶æ…‹ã«åæ˜ 
      updateSelectedLocations();

      // åˆæœŸçŠ¶æ…‹ï¼šæœªãƒ­ã‚°ã‚¤ãƒ³UI
      showLoggedOutUI();

      // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
      if (window.scheduleAPI) {
        try {
          const user = await window.scheduleAPI.checkLoginStatus();
          if (user) {
            updateLoginUI(user);
          }
        } catch (error) {
          console.error('ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
        }
      }
    });

    // å†™çœŸæ‹¡å¤§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
    function showPhotoPopup(src) {
      const overlay = document.createElement('div');
      overlay.id = 'photo-popup-overlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.9);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        cursor: pointer;
      `;
      overlay.onclick = () => overlay.remove();

      const img = document.createElement('img');
      img.src = src;
      img.style.cssText = `
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      `;

      const closeBtn = document.createElement('div');
      closeBtn.innerHTML = 'âœ•';
      closeBtn.style.cssText = `
        position: absolute;
        top: 20px;
        right: 20px;
        color: white;
        font-size: 24px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(255,255,255,0.2);
        border-radius: 50%;
      `;

      overlay.appendChild(img);
      overlay.appendChild(closeBtn);
      document.body.appendChild(overlay);
    }
  </script>
</body>
</html>
